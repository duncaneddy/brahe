name: Unit Tests

on:
    push:
        branches:
            - main
        # Only run if source/test files changed
        paths:
            - 'examples/**'
            - 'plots/**'
            - 'brahe/**'
            - 'src/**'
            - 'tests/**'
            - 'test_assets/**'
            - 'data/**'
            - 'Cargo.toml'
            - 'Cargo.lock'
            - 'pyproject.toml'
            - 'uv.lock'
            - '.github/workflows/unit_tests.yml'
            - '.github/workflows/test_*.yml'

concurrency:
    group: unit-tests-${{ github.ref }}
    cancel-in-progress: true

jobs:
    test-rust:
        uses: ./.github/workflows/test_rust.yml
    delay-python:
        runs-on: ubuntu-latest
        steps:
            - name: Wait for Rust tests to claim runners
              run: sleep 15
    test-python:
        needs: [delay-python]
        uses: ./.github/workflows/test_python.yml
    test-examples:
        # needs: [ test-rust ] # Remove this dependency for optimistic parallel execution
        uses: ./.github/workflows/test_examples.yml
    update-docs:
        needs: [ test-rust, test-python, test-examples ]
        uses: ./.github/workflows/update_docs.yml