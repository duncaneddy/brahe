<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Brahe - Practical Astrodynamics"><meta name=author content="Duncan Eddy"><link rel=canonical href=https://duncaneddy.github.io/brahe/latest/learn/integrators/sensitivity_matrix.html><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.20"><title>Sensitivity Matrix - Brahe</title><link rel=stylesheet href=../../assets/stylesheets/main.e53b48f4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../stylesheets/extra.5dba32.min.css><link rel=stylesheet href=https://unpkg.com/katex@0/dist/katex.min.css><link rel=stylesheet href=../../stylesheets/neoteroi-mkdocs.249355.min.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-H1DDT6G6K6"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-H1DDT6G6K6",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-H1DDT6G6K6",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=black> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#sensitivity-matrix class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=Brahe class="md-header__button md-logo" aria-label=Brahe data-md-component=logo> <img src=../../assets/icon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Brahe </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Sensitivity Matrix </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=black aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=black aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/duncaneddy/brahe title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../index.html class=md-tabs__link> Brahe </a> </li> <li class=md-tabs__item> <a href=../index.html class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../examples/index.html class=md-tabs__link> Examples </a> </li> <li class=md-tabs__item> <a href=../../library_api/index.html class=md-tabs__link> Python API Reference </a> </li> <li class=md-tabs__item> <a href=https://docs.rs/brahe class=md-tabs__link> Rust API Reference </a> </li> <li class=md-tabs__item> <a href=https://duncaneddy.com class=md-tabs__link> About Me </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Brahe class="md-nav__button md-logo" aria-label=Brahe data-md-component=logo> <img src=../../assets/icon.png alt=logo> </a> Brahe </label> <div class=md-nav__source> <a href=https://github.com/duncaneddy/brahe title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=../../index.html class="md-nav__link "> <span class=md-ellipsis> Brahe </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Brahe </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../installation.html class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class=md-nav__item> <a href=../../roadmap.html class=md-nav__link> <span class=md-ellipsis> Roadmap </span> </a> </li> <li class=md-nav__item> <a href=../../versioning.html class=md-nav__link> <span class=md-ellipsis> Versioning </span> </a> </li> <li class=md-nav__item> <a href=../../changelog.html class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_1_6> <div class="md-nav__link md-nav__container"> <a href=../../design.html class="md-nav__link "> <span class=md-ellipsis> Development Guidelines </span> </a> <label class="md-nav__link " for=__nav_1_6 id=__nav_1_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_6_label aria-expanded=false> <label class=md-nav__title for=__nav_1_6> <span class="md-nav__icon md-icon"></span> Development Guidelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing.html class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../development_guidelines.html class=md-nav__link> <span class=md-ellipsis> Development Guidelines </span> </a> </li> <li class=md-nav__item> <a href=../../code_of_conduct.html class=md-nav__link> <span class=md-ellipsis> Code of Conduct </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../index.html class="md-nav__link "> <span class=md-ellipsis> User Guide </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../constants.html class=md-nav__link> <span class=md-ellipsis> Constants </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_2> <div class="md-nav__link md-nav__container"> <a href=../eop/index.html class="md-nav__link "> <span class=md-ellipsis> Earth Orientation Data </span> </a> <label class="md-nav__link " for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Earth Orientation Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../eop/what_is_eop_data.html class=md-nav__link> <span class=md-ellipsis> What is EOP Data? </span> </a> </li> <li class=md-nav__item> <a href=../eop/managing_eop_data.html class=md-nav__link> <span class=md-ellipsis> Managing EOP Data </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_3> <div class="md-nav__link md-nav__container"> <a href=../time/index.html class="md-nav__link "> <span class=md-ellipsis> Time </span> </a> <label class="md-nav__link " for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Time </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../time/epoch.html class=md-nav__link> <span class=md-ellipsis> Epoch </span> </a> </li> <li class=md-nav__item> <a href=../time/time_range.html class=md-nav__link> <span class=md-ellipsis> Time Range </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_4> <div class="md-nav__link md-nav__container"> <a href=../coordinates/index.html class="md-nav__link "> <span class=md-ellipsis> Coordinate Transformations </span> </a> <label class="md-nav__link " for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Coordinate Transformations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../coordinates/cartesian_transformations.html class=md-nav__link> <span class=md-ellipsis> Cartesian ↔ Orbital Element Transformations </span> </a> </li> <li class=md-nav__item> <a href=../coordinates/geocentric_transformations.html class=md-nav__link> <span class=md-ellipsis> Geocentric Transformations </span> </a> </li> <li class=md-nav__item> <a href=../coordinates/geodetic_transformations.html class=md-nav__link> <span class=md-ellipsis> Geodetic Transformations </span> </a> </li> <li class=md-nav__item> <a href=../coordinates/topocentric_transformations.html class=md-nav__link> <span class=md-ellipsis> Topocentric Coordinate Transformations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_5> <div class="md-nav__link md-nav__container"> <a href=../frames/index.html class="md-nav__link "> <span class=md-ellipsis> Reference Frame Transformations </span> </a> <label class="md-nav__link " for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> Reference Frame Transformations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../frames/eci_ecef.html class=md-nav__link> <span class=md-ellipsis> ECI ↔ ECEF Transformations </span> </a> </li> <li class=md-nav__item> <a href=../frames/gcrf_itrf.html class=md-nav__link> <span class=md-ellipsis> GCRF ↔ ITRF Transformations </span> </a> </li> <li class=md-nav__item> <a href=../frames/eme2000_gcrf.html class=md-nav__link> <span class=md-ellipsis> EME2000 ↔ GCRF Transformations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_6> <div class="md-nav__link md-nav__container"> <a href=../orbits/index.html class="md-nav__link "> <span class=md-ellipsis> Orbits </span> </a> <label class="md-nav__link " for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Orbits </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../orbits/anomalies.html class=md-nav__link> <span class=md-ellipsis> Anomaly Conversions </span> </a> </li> <li class=md-nav__item> <a href=../orbits/properties.html class=md-nav__link> <span class=md-ellipsis> Orbital Properties </span> </a> </li> <li class=md-nav__item> <a href=../orbits/two_line_elements.html class=md-nav__link> <span class=md-ellipsis> Two-Line Elements (TLE) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_7> <div class="md-nav__link md-nav__container"> <a href=../attitude_representations/index.html class="md-nav__link "> <span class=md-ellipsis> Attitude Representation </span> </a> <label class="md-nav__link " for=__nav_2_7 id=__nav_2_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> Attitude Representation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../attitude_representations/quaternions.html class=md-nav__link> <span class=md-ellipsis> Quaternions </span> </a> </li> <li class=md-nav__item> <a href=../attitude_representations/rotation_matrices.html class=md-nav__link> <span class=md-ellipsis> Rotation Matrices </span> </a> </li> <li class=md-nav__item> <a href=../attitude_representations/euler_angles.html class=md-nav__link> <span class=md-ellipsis> Euler Angles </span> </a> </li> <li class=md-nav__item> <a href=../attitude_representations/euler_axis.html class=md-nav__link> <span class=md-ellipsis> Euler Axis (Axis-Angle) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_8> <div class="md-nav__link md-nav__container"> <a href=../trajectories/index.html class="md-nav__link "> <span class=md-ellipsis> Trajectories </span> </a> <label class="md-nav__link " for=__nav_2_8 id=__nav_2_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_8_label aria-expanded=false> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> Trajectories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../trajectories/dtrajectory.html class=md-nav__link> <span class=md-ellipsis> DTrajectory </span> </a> </li> <li class=md-nav__item> <a href=../trajectories/strajectory6.html class=md-nav__link> <span class=md-ellipsis> STrajectory6 </span> </a> </li> <li class=md-nav__item> <a href=../trajectories/orbit_trajectory.html class=md-nav__link> <span class=md-ellipsis> OrbitTrajectory </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_9> <div class="md-nav__link md-nav__container"> <a href=../orbital_dynamics/index.html class="md-nav__link "> <span class=md-ellipsis> Orbital Dynamics </span> </a> <label class="md-nav__link " for=__nav_2_9 id=__nav_2_9_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_9_label aria-expanded=false> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> Orbital Dynamics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../orbital_dynamics/gravity.html class=md-nav__link> <span class=md-ellipsis> Gravity Models </span> </a> </li> <li class=md-nav__item> <a href=../orbital_dynamics/third_body.html class=md-nav__link> <span class=md-ellipsis> Third-Body Perturbations </span> </a> </li> <li class=md-nav__item> <a href=../orbital_dynamics/drag.html class=md-nav__link> <span class=md-ellipsis> Atmospheric Drag </span> </a> </li> <li class=md-nav__item> <a href=../orbital_dynamics/solar_radiation_pressure.html class=md-nav__link> <span class=md-ellipsis> Solar Radiation Pressure </span> </a> </li> <li class=md-nav__item> <a href=../orbital_dynamics/relativity.html class=md-nav__link> <span class=md-ellipsis> Relativistic Effects </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_10> <div class="md-nav__link md-nav__container"> <a href=../orbit_propagation/index.html class="md-nav__link "> <span class=md-ellipsis> Orbit Propagation </span> </a> <label class="md-nav__link " for=__nav_2_10 id=__nav_2_10_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_10_label aria-expanded=false> <label class=md-nav__title for=__nav_2_10> <span class="md-nav__icon md-icon"></span> Orbit Propagation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../orbit_propagation/keplerian_propagation.html class=md-nav__link> <span class=md-ellipsis> Keplerian Propagation </span> </a> </li> <li class=md-nav__item> <a href=../orbit_propagation/sgp_propagation.html class=md-nav__link> <span class=md-ellipsis> SGP Propagation </span> </a> </li> <li class=md-nav__item> <a href=../orbit_propagation/parallel_propagation.html class=md-nav__link> <span class=md-ellipsis> Parallel Propagation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_11> <div class="md-nav__link md-nav__container"> <a href=../relative_motion/index.html class="md-nav__link "> <span class=md-ellipsis> Relative Motion </span> </a> <label class="md-nav__link " for=__nav_2_11 id=__nav_2_11_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_11_label aria-expanded=false> <label class=md-nav__title for=__nav_2_11> <span class="md-nav__icon md-icon"></span> Relative Motion </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../relative_motion/rtn_transformations.html class=md-nav__link> <span class=md-ellipsis> RTN Transformations </span> </a> </li> <li class=md-nav__item> <a href=../relative_motion/roe_transformations.html class=md-nav__link> <span class=md-ellipsis> Relative Orbital Elements (ROE) Transformations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_12> <div class="md-nav__link md-nav__container"> <a href=../access_computation/index.html class="md-nav__link "> <span class=md-ellipsis> Access Computation </span> </a> <label class="md-nav__link " for=__nav_2_12 id=__nav_2_12_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_12_label aria-expanded=false> <label class=md-nav__title for=__nav_2_12> <span class="md-nav__icon md-icon"></span> Access Computation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../access_computation/locations.html class=md-nav__link> <span class=md-ellipsis> Locations </span> </a> </li> <li class=md-nav__item> <a href=../access_computation/constraints.html class=md-nav__link> <span class=md-ellipsis> Constraints </span> </a> </li> <li class=md-nav__item> <a href=../access_computation/properties.html class=md-nav__link> <span class=md-ellipsis> Properties </span> </a> </li> <li class=md-nav__item> <a href=../access_computation/computation.html class=md-nav__link> <span class=md-ellipsis> Computation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_13> <div class="md-nav__link md-nav__container"> <a href=../mathematics/index.html class="md-nav__link "> <span class=md-ellipsis> Mathematics </span> </a> <label class="md-nav__link " for=__nav_2_13 id=__nav_2_13_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_13_label aria-expanded=false> <label class=md-nav__title for=__nav_2_13> <span class="md-nav__icon md-icon"></span> Mathematics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../mathematics/jacobian.html class=md-nav__link> <span class=md-ellipsis> Jacobian Computation </span> </a> </li> <li class=md-nav__item> <a href=../mathematics/sensitivity.md class=md-nav__link> <span class=md-ellipsis> Sensitivity Matrices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_14> <div class="md-nav__link md-nav__container"> <a href=index.html class="md-nav__link "> <span class=md-ellipsis> Numerical Integration </span> </a> <label class="md-nav__link " for=__nav_2_14 id=__nav_2_14_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_14_label aria-expanded=false> <label class=md-nav__title for=__nav_2_14> <span class="md-nav__icon md-icon"></span> Numerical Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=fixed_step.html class=md-nav__link> <span class=md-ellipsis> Fixed-Step Integrators </span> </a> </li> <li class=md-nav__item> <a href=adaptive_step.html class=md-nav__link> <span class=md-ellipsis> Adaptive-Step Integrators </span> </a> </li> <li class=md-nav__item> <a href=variational_equations.html class=md-nav__link> <span class=md-ellipsis> Variational Equations </span> </a> </li> <li class=md-nav__item> <a href=configuration.html class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_15> <div class="md-nav__link md-nav__container"> <a href=../space_weather/index.html class="md-nav__link "> <span class=md-ellipsis> Space Weather Data </span> </a> <label class="md-nav__link " for=__nav_2_15 id=__nav_2_15_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_15_label aria-expanded=false> <label class=md-nav__title for=__nav_2_15> <span class="md-nav__icon md-icon"></span> Space Weather Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../space_weather/managing_space_weather_data.html class=md-nav__link> <span class=md-ellipsis> Managing Space Weather Data </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_16> <div class="md-nav__link md-nav__container"> <a href=../datasets/index.html class="md-nav__link "> <span class=md-ellipsis> Datasets </span> </a> <label class="md-nav__link " for=__nav_2_16 id=__nav_2_16_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_16_label aria-expanded=false> <label class=md-nav__title for=__nav_2_16> <span class="md-nav__icon md-icon"></span> Datasets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../datasets/celestrak.html class=md-nav__link> <span class=md-ellipsis> CelesTrak </span> </a> </li> <li class=md-nav__item> <a href=../datasets/naif.html class=md-nav__link> <span class=md-ellipsis> NAIF </span> </a> </li> <li class=md-nav__item> <a href=../datasets/groundstations.html class=md-nav__link> <span class=md-ellipsis> Groundstations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_17> <div class="md-nav__link md-nav__container"> <a href=../utilities/index.html class="md-nav__link "> <span class=md-ellipsis> Utilities </span> </a> <label class="md-nav__link " for=__nav_2_17 id=__nav_2_17_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_17_label aria-expanded=false> <label class=md-nav__title for=__nav_2_17> <span class="md-nav__icon md-icon"></span> Utilities </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../utilities/caching.html class=md-nav__link> <span class=md-ellipsis> Caching </span> </a> </li> <li class=md-nav__item> <a href=../utilities/threading.html class=md-nav__link> <span class=md-ellipsis> Multithreading </span> </a> </li> <li class=md-nav__item> <a href=../utilities/string_formatting.html class=md-nav__link> <span class=md-ellipsis> String Formatting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_18> <div class="md-nav__link md-nav__container"> <a href=../plots/index.html class="md-nav__link "> <span class=md-ellipsis> Plots </span> </a> <label class="md-nav__link " for=__nav_2_18 id=__nav_2_18_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_18_label aria-expanded=false> <label class=md-nav__title for=__nav_2_18> <span class="md-nav__icon md-icon"></span> Plots </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../plots/orbital_trajectories.html class=md-nav__link> <span class=md-ellipsis> Orbital Trajectories </span> </a> </li> <li class=md-nav__item> <a href=../plots/3d_trajectory.html class=md-nav__link> <span class=md-ellipsis> 3D Trajectory </span> </a> </li> <li class=md-nav__item> <a href=../plots/ground_tracks.html class=md-nav__link> <span class=md-ellipsis> Ground Tracks </span> </a> </li> <li class=md-nav__item> <a href=../plots/access_geometry.html class=md-nav__link> <span class=md-ellipsis> Access Geometry </span> </a> </li> <li class=md-nav__item> <a href=../plots/gabbard_plot.html class=md-nav__link> <span class=md-ellipsis> Gabbard Plots </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_19> <div class="md-nav__link md-nav__container"> <a href=../cli/index.html class="md-nav__link "> <span class=md-ellipsis> Command Line Interface </span> </a> <label class="md-nav__link " for=__nav_2_19 id=__nav_2_19_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_19_label aria-expanded=false> <label class=md-nav__title for=__nav_2_19> <span class="md-nav__icon md-icon"></span> Command Line Interface </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cli/eop.html class=md-nav__link> <span class=md-ellipsis> EOP </span> </a> </li> <li class=md-nav__item> <a href=../cli/time.html class=md-nav__link> <span class=md-ellipsis> Time </span> </a> </li> <li class=md-nav__item> <a href=../cli/orbits.html class=md-nav__link> <span class=md-ellipsis> Orbits </span> </a> </li> <li class=md-nav__item> <a href=../cli/transform.html class=md-nav__link> <span class=md-ellipsis> Transform </span> </a> </li> <li class=md-nav__item> <a href=../cli/datasets.html class=md-nav__link> <span class=md-ellipsis> Datasets </span> </a> </li> <li class=md-nav__item> <a href=../cli/access.html class=md-nav__link> <span class=md-ellipsis> Access </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../examples/index.html class="md-nav__link "> <span class=md-ellipsis> Examples </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../examples/visualizing_gps.html class=md-nav__link> <span class=md-ellipsis> Visualizing GPS Satellite Orbits </span> </a> </li> <li class=md-nav__item> <a href=../../examples/visualizing_starlink.html class=md-nav__link> <span class=md-ellipsis> Downloading &amp; Visualizing TLE Data For Starlink Satellites </span> </a> </li> <li class=md-nav__item> <a href=../../examples/ground_contacts.html class=md-nav__link> <span class=md-ellipsis> Predicting Ground Contacts </span> </a> </li> <li class=md-nav__item> <a href=../../examples/doppler_compensation.html class=md-nav__link> <span class=md-ellipsis> Calculating Doppler Compensation </span> </a> </li> <li class=md-nav__item> <a href=../../examples/max_communications_gap.html class=md-nav__link> <span class=md-ellipsis> Maximum Communications Gap </span> </a> </li> <li class=md-nav__item> <a href=../../examples/imaging_opportunities.html class=md-nav__link> <span class=md-ellipsis> Earth Observation Imaging Opportunities </span> </a> </li> <li class=md-nav__item> <a href=../../examples/using_different_integrators.html class=md-nav__link> <span class=md-ellipsis> Comparing Integrator Performance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <div class="md-nav__link md-nav__container"> <a href=../../library_api/index.html class="md-nav__link "> <span class=md-ellipsis> Python API Reference </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Python API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_1> <div class="md-nav__link md-nav__container"> <a href=../../library_api/constants/index.html class="md-nav__link "> <span class=md-ellipsis> Constants </span> </a> <label class="md-nav__link " for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Constants </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/constants/units.html class=md-nav__link> <span class=md-ellipsis> Units </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/constants/math.html class=md-nav__link> <span class=md-ellipsis> Mathematical </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/constants/time.html class=md-nav__link> <span class=md-ellipsis> Time </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/constants/physical.html class=md-nav__link> <span class=md-ellipsis> Physical </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_2> <div class="md-nav__link md-nav__container"> <a href=../../library_api/eop/index.html class="md-nav__link "> <span class=md-ellipsis> EOP </span> </a> <label class="md-nav__link " for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> EOP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/eop/caching_provider.html class=md-nav__link> <span class=md-ellipsis> CachingEOPProvider </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/eop/file_provider.html class=md-nav__link> <span class=md-ellipsis> FileEOPProvider </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/eop/static_provider.html class=md-nav__link> <span class=md-ellipsis> StaticEOPProvider </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/eop/functions.html class=md-nav__link> <span class=md-ellipsis> Functions </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_3> <div class="md-nav__link md-nav__container"> <a href=../../library_api/time/index.html class="md-nav__link "> <span class=md-ellipsis> Time </span> </a> <label class="md-nav__link " for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Time </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/time/epoch.html class=md-nav__link> <span class=md-ellipsis> Epoch </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/time/conversions.html class=md-nav__link> <span class=md-ellipsis> Conversions </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/time/time_range.html class=md-nav__link> <span class=md-ellipsis> TimeRange </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_4> <div class="md-nav__link md-nav__container"> <a href=../../library_api/coordinates/index.html class="md-nav__link "> <span class=md-ellipsis> Coordinates </span> </a> <label class="md-nav__link " for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Coordinates </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/coordinates/cartesian.html class=md-nav__link> <span class=md-ellipsis> Cartesian </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/coordinates/geodetic.html class=md-nav__link> <span class=md-ellipsis> Geodetic & Geocentric </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/coordinates/topocentric.html class=md-nav__link> <span class=md-ellipsis> Topocentric </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/coordinates/enums.html class=md-nav__link> <span class=md-ellipsis> Enumerations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_5> <div class="md-nav__link md-nav__container"> <a href=../../library_api/frames/index.html class="md-nav__link "> <span class=md-ellipsis> Frames </span> </a> <label class="md-nav__link " for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Frames </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/frames/eci_ecef.html class=md-nav__link> <span class=md-ellipsis> ECI ↔ ECEF </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/frames/gcrf_itrf.html class=md-nav__link> <span class=md-ellipsis> GCRF ↔ ITRF </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/frames/eme2000_gcrf.html class=md-nav__link> <span class=md-ellipsis> EME2000 ↔ GCRF </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_6> <div class="md-nav__link md-nav__container"> <a href=../../library_api/orbits/index.html class="md-nav__link "> <span class=md-ellipsis> Orbits </span> </a> <label class="md-nav__link " for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> Orbits </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/orbits/keplerian.html class=md-nav__link> <span class=md-ellipsis> Keplerian Elements </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/orbits/tle.html class=md-nav__link> <span class=md-ellipsis> Two-Line Elements </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/orbits/altitude_functions.html class=md-nav__link> <span class=md-ellipsis> Altitude Functions </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/orbits/enums.html class=md-nav__link> <span class=md-ellipsis> Enumerations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_7> <div class="md-nav__link md-nav__container"> <a href=../../library_api/attitude/index.html class="md-nav__link "> <span class=md-ellipsis> Attitude </span> </a> <label class="md-nav__link " for=__nav_4_7 id=__nav_4_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> Attitude </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/attitude/quaternion.html class=md-nav__link> <span class=md-ellipsis> Quaternion </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/attitude/rotation_matrix.html class=md-nav__link> <span class=md-ellipsis> Rotation Matrix </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/attitude/euler_angles.html class=md-nav__link> <span class=md-ellipsis> Euler Angles </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/attitude/euler_axis.html class=md-nav__link> <span class=md-ellipsis> Euler Axis </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/attitude/euler_angle_order.html class=md-nav__link> <span class=md-ellipsis> EulerAngleOrder </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_8> <div class="md-nav__link md-nav__container"> <a href=../../library_api/trajectories/index.html class="md-nav__link "> <span class=md-ellipsis> Trajectories </span> </a> <label class="md-nav__link " for=__nav_4_8 id=__nav_4_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> Trajectories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/trajectories/dtrajectory.html class=md-nav__link> <span class=md-ellipsis> DTrajectory </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/trajectories/strajectory6.html class=md-nav__link> <span class=md-ellipsis> STrajectory6 </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/trajectories/orbit_trajectory.html class=md-nav__link> <span class=md-ellipsis> OrbitTrajectory </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_9> <div class="md-nav__link md-nav__container"> <a href=../../library_api/orbit_dynamics/index.html class="md-nav__link "> <span class=md-ellipsis> Orbital Dynamics </span> </a> <label class="md-nav__link " for=__nav_4_9 id=__nav_4_9_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> Orbital Dynamics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/orbit_dynamics/gravity.html class=md-nav__link> <span class=md-ellipsis> Gravity Models </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/orbit_dynamics/third_body.html class=md-nav__link> <span class=md-ellipsis> Third-Body </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/orbit_dynamics/drag.html class=md-nav__link> <span class=md-ellipsis> Atmospheric Drag </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/orbit_dynamics/atmospheric_density_models.html class=md-nav__link> <span class=md-ellipsis> Atmospheric Density </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/orbit_dynamics/solar_radiation_pressure.html class=md-nav__link> <span class=md-ellipsis> Solar Radiation Pressure </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/orbit_dynamics/relativity.html class=md-nav__link> <span class=md-ellipsis> Relativistic Effects </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/orbit_dynamics/ephemerides.html class=md-nav__link> <span class=md-ellipsis> Ephemerides </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_10> <div class="md-nav__link md-nav__container"> <a href=../../library_api/propagators/index.html class="md-nav__link "> <span class=md-ellipsis> Propagators </span> </a> <label class="md-nav__link " for=__nav_4_10 id=__nav_4_10_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_10_label aria-expanded=false> <label class=md-nav__title for=__nav_4_10> <span class="md-nav__icon md-icon"></span> Propagators </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/propagators/keplerian_propagator.html class=md-nav__link> <span class=md-ellipsis> KeplerianPropagator </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/propagators/sgp_propagator.html class=md-nav__link> <span class=md-ellipsis> SGPPropagator </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/propagators/functions.html class=md-nav__link> <span class=md-ellipsis> Functions </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_11> <div class="md-nav__link md-nav__container"> <a href=../../library_api/relative_motion/index.html class="md-nav__link "> <span class=md-ellipsis> Relative Motion </span> </a> <label class="md-nav__link " for=__nav_4_11 id=__nav_4_11_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_11_label aria-expanded=false> <label class=md-nav__title for=__nav_4_11> <span class="md-nav__icon md-icon"></span> Relative Motion </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/relative_motion/rtn_transformations.html class=md-nav__link> <span class=md-ellipsis> RTN Transformations </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/relative_motion/roe_transformations.html class=md-nav__link> <span class=md-ellipsis> ROE Transformations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_12> <div class="md-nav__link md-nav__container"> <a href=../../library_api/access/index.html class="md-nav__link "> <span class=md-ellipsis> Access </span> </a> <label class="md-nav__link " for=__nav_4_12 id=__nav_4_12_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_12_label aria-expanded=false> <label class=md-nav__title for=__nav_4_12> <span class="md-nav__icon md-icon"></span> Access </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/access/locations.html class=md-nav__link> <span class=md-ellipsis> Locations </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/access/constraints.html class=md-nav__link> <span class=md-ellipsis> Constraints </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/access/constraint_computer.html class=md-nav__link> <span class=md-ellipsis> Constraint Computer </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/access/properties.html class=md-nav__link> <span class=md-ellipsis> Properties </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/access/windows.html class=md-nav__link> <span class=md-ellipsis> Windows </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/access/enums.html class=md-nav__link> <span class=md-ellipsis> Enumerations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_13> <div class="md-nav__link md-nav__container"> <a href=../../library_api/mathematics/index.html class="md-nav__link "> <span class=md-ellipsis> Mathematics </span> </a> <label class="md-nav__link " for=__nav_4_13 id=__nav_4_13_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_13_label aria-expanded=false> <label class=md-nav__title for=__nav_4_13> <span class="md-nav__icon md-icon"></span> Mathematics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/mathematics/jacobian.html class=md-nav__link> <span class=md-ellipsis> Jacobian </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/mathematics/sensitivity.html class=md-nav__link> <span class=md-ellipsis> Sensitivity Matrices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_14> <div class="md-nav__link md-nav__container"> <a href=../../library_api/integrators/index.html class="md-nav__link "> <span class=md-ellipsis> Integrators </span> </a> <label class="md-nav__link " for=__nav_4_14 id=__nav_4_14_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_14_label aria-expanded=false> <label class=md-nav__title for=__nav_4_14> <span class="md-nav__icon md-icon"></span> Integrators </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/integrators/config.html class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/integrators/rk4.html class=md-nav__link> <span class=md-ellipsis> RK4 Integrator </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/integrators/rkf45.html class=md-nav__link> <span class=md-ellipsis> RKF45 Integrator </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/integrators/dp54.html class=md-nav__link> <span class=md-ellipsis> DP54 Integrator </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/integrators/rkn1210.html class=md-nav__link> <span class=md-ellipsis> RKN1210 Integrator </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_15> <div class="md-nav__link md-nav__container"> <a href=../../library_api/space_weather/index.html class="md-nav__link "> <span class=md-ellipsis> Space Weather </span> </a> <label class="md-nav__link " for=__nav_4_15 id=__nav_4_15_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_15_label aria-expanded=false> <label class=md-nav__title for=__nav_4_15> <span class="md-nav__icon md-icon"></span> Space Weather </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/space_weather/functions.html class=md-nav__link> <span class=md-ellipsis> Functions </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/space_weather/caching_provider.html class=md-nav__link> <span class=md-ellipsis> CachingSpaceWeatherProvider </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/space_weather/file_provider.html class=md-nav__link> <span class=md-ellipsis> FileSpaceWeatherProvider </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/space_weather/static_provider.html class=md-nav__link> <span class=md-ellipsis> StaticSpaceWeatherProvider </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_16> <div class="md-nav__link md-nav__container"> <a href=../../library_api/earth_models/index.html class="md-nav__link "> <span class=md-ellipsis> Earth Models </span> </a> <label class="md-nav__link " for=__nav_4_16 id=__nav_4_16_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_16_label aria-expanded=false> <label class=md-nav__title for=__nav_4_16> <span class="md-nav__icon md-icon"></span> Earth Models </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/earth_models/harris_priester.html class=md-nav__link> <span class=md-ellipsis> Harris-Priester </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/earth_models/nrlmsise00.html class=md-nav__link> <span class=md-ellipsis> NRLMSISE-00 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_17> <div class="md-nav__link md-nav__container"> <a href=../../library_api/datasets/index.html class="md-nav__link "> <span class=md-ellipsis> Datasets </span> </a> <label class="md-nav__link " for=__nav_4_17 id=__nav_4_17_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_17_label aria-expanded=false> <label class=md-nav__title for=__nav_4_17> <span class="md-nav__icon md-icon"></span> Datasets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/datasets/celestrak.html class=md-nav__link> <span class=md-ellipsis> CelesTrak </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/datasets/groundstations.html class=md-nav__link> <span class=md-ellipsis> Groundstations </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/datasets/naif.html class=md-nav__link> <span class=md-ellipsis> NAIF </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_18> <div class="md-nav__link md-nav__container"> <a href=../../library_api/utils/index.html class="md-nav__link "> <span class=md-ellipsis> Utilities </span> </a> <label class="md-nav__link " for=__nav_4_18 id=__nav_4_18_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_18_label aria-expanded=false> <label class=md-nav__title for=__nav_4_18> <span class="md-nav__icon md-icon"></span> Utilities </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/utils/caching.html class=md-nav__link> <span class=md-ellipsis> Caching </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/utils/threading.html class=md-nav__link> <span class=md-ellipsis> Multithreading </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/utils/formatting.html class=md-nav__link> <span class=md-ellipsis> String Formatting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_19> <div class="md-nav__link md-nav__container"> <a href=../../library_api/plots/index.html class="md-nav__link "> <span class=md-ellipsis> Plots </span> </a> <label class="md-nav__link " for=__nav_4_19 id=__nav_4_19_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_19_label aria-expanded=false> <label class=md-nav__title for=__nav_4_19> <span class="md-nav__icon md-icon"></span> Plots </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../library_api/plots/ground_tracks.html class=md-nav__link> <span class=md-ellipsis> Ground Tracks </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/plots/orbital_trajectories.html class=md-nav__link> <span class=md-ellipsis> Orbital Trajectories </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/plots/3d_trajectory.html class=md-nav__link> <span class=md-ellipsis> 3D Trajectory </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/plots/access_geometry.html class=md-nav__link> <span class=md-ellipsis> Access Geometry </span> </a> </li> <li class=md-nav__item> <a href=../../library_api/plots/gabbard.html class=md-nav__link> <span class=md-ellipsis> Gabbard Diagram </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://docs.rs/brahe class=md-nav__link> <span class=md-ellipsis> Rust API Reference </span> </a> </li> <li class=md-nav__item> <a href=https://duncaneddy.com class=md-nav__link> <span class=md-ellipsis> About Me </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-is-the-sensitivity-matrix class=md-nav__link> <span class=md-ellipsis> What is the Sensitivity Matrix? </span> </a> </li> <li class=md-nav__item> <a href=#relationship-to-stm class=md-nav__link> <span class=md-ellipsis> Relationship to STM </span> </a> </li> <li class=md-nav__item> <a href=#propagating-the-sensitivity-matrix class=md-nav__link> <span class=md-ellipsis> Propagating the Sensitivity Matrix </span> </a> </li> <li class=md-nav__item> <a href=#using-sensitivity-providers class=md-nav__link> <span class=md-ellipsis> Using Sensitivity Providers </span> </a> <nav class=md-nav aria-label="Using Sensitivity Providers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#when-to-use-analytical-sensitivity class=md-nav__link> <span class=md-ellipsis> When to Use Analytical Sensitivity </span> </a> </li> <li class=md-nav__item> <a href=#perturbation-strategies class=md-nav__link> <span class=md-ellipsis> Perturbation Strategies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#integrating-sensitivity-matrices class=md-nav__link> <span class=md-ellipsis> Integrating Sensitivity Matrices </span> </a> </li> <li class=md-nav__item> <a href=#see-also class=md-nav__link> <span class=md-ellipsis> See Also </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=sensitivity-matrix>Sensitivity Matrix<a class=headerlink href=#sensitivity-matrix title="Permanent link">&para;</a></h1> <p>The sensitivity matrix extends variational equations to include the effect of uncertain parameters on the state. While the State Transition Matrix (STM) maps initial state uncertainties to final state uncertainties, the sensitivity matrix maps parameter uncertainties to state uncertainties.</p> <h2 id=what-is-the-sensitivity-matrix>What is the Sensitivity Matrix?<a class=headerlink href=#what-is-the-sensitivity-matrix title="Permanent link">&para;</a></h2> <p>For a dynamical system that depends on both state and parameters:</p> <div class=arithmatex>\[\dot{\mathbf{x}} = \mathbf{f}(t, \mathbf{x}, \mathbf{p})\]</div> <p>where <span class=arithmatex>\(\mathbf{p}\)</span> is a vector of "consider parameters" (parameters that affect dynamics but aren't estimated), the sensitivity matrix <span class=arithmatex>\(\mathbf{S}\)</span> describes how state evolves with respect to parameter changes:</p> <div class=arithmatex>\[\mathbf{S}(t) = \frac{\partial \mathbf{x}(t)}{\partial \mathbf{p}}\]</div> <p>The sensitivity matrix satisfies the differential equation:</p> <div class=arithmatex>\[\dot{\mathbf{S}} = \frac{\partial \mathbf{f}(t, \mathbf{x}, \mathbf{p})}{\partial \mathbf{x}} \mathbf{S} + \frac{\partial \mathbf{f}(t, \mathbf{x}, \mathbf{p})}{\partial \mathbf{p}}\]</div> <p>Sensitivity matrices are essential for accounting for parameter uncertainties in orbit determination.</p> <h2 id=relationship-to-stm>Relationship to STM<a class=headerlink href=#relationship-to-stm title="Permanent link">&para;</a></h2> <p>The sensitivity matrix and STM serve related but distinct purposes:</p> <div class=center-table> <table> <thead> <tr> <th>Matrix</th> <th>Equation</th> <th>Maps</th> </tr> </thead> <tbody> <tr> <td>STM <span class=arithmatex>\(\Phi\)</span></td> <td><span class=arithmatex>\(\dot{\Phi} = \mathbf{A}\Phi\)</span></td> <td>Initial state → Final state</td> </tr> <tr> <td>Sensitivity <span class=arithmatex>\(\mathbf{S}\)</span></td> <td><span class=arithmatex>\(\dot{\mathbf{S}} = \mathbf{A}\mathbf{S} + \mathbf{B}\)</span></td> <td>Parameters → Final state</td> </tr> </tbody> </table> </div> <h2 id=propagating-the-sensitivity-matrix>Propagating the Sensitivity Matrix<a class=headerlink href=#propagating-the-sensitivity-matrix title="Permanent link">&para;</a></h2> <p>Brahe integrators provide <code>step_with_sensmat()</code> for propagating the sensitivity matrix alongside the state:</p> <div class="language-rust highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1>1</a></span>
<span class=normal><a href=#__codelineno-0-2>2</a></span>
<span class=normal><a href=#__codelineno-0-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=c1>// Result: (new_state, new_sensitivity, dt_used, error, dt_next)</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=kd>let</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=n>sens</span><span class=p>,</span><span class=w> </span><span class=n>dt_used</span><span class=p>,</span><span class=w> </span><span class=n>error</span><span class=p>,</span><span class=w> </span><span class=n>dt_next</span><span class=p>)</span><span class=w> </span><span class=o>=</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=w>    </span><span class=n>integrator</span><span class=p>.</span><span class=n>step_with_sensmat</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=n>sensitivity</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>params</span><span class=p>,</span><span class=w> </span><span class=n>dt</span><span class=p>);</span>
</span></code></pre></div></td></tr></table></div> <p>For combined STM and sensitivity propagation:</p> <div class="language-rust highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1>1</a></span>
<span class=normal><a href=#__codelineno-1-2>2</a></span>
<span class=normal><a href=#__codelineno-1-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1></a><span class=c1>// Result: (new_state, new_stm, new_sensitivity, dt_used, error, dt_next)</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2></a><span class=kd>let</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=n>phi</span><span class=p>,</span><span class=w> </span><span class=n>sens</span><span class=p>,</span><span class=w> </span><span class=n>dt_used</span><span class=p>,</span><span class=w> </span><span class=n>error</span><span class=p>,</span><span class=w> </span><span class=n>dt_next</span><span class=p>)</span><span class=w> </span><span class=o>=</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3></a><span class=w>    </span><span class=n>integrator</span><span class=p>.</span><span class=n>step_with_varmat_sensmat</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=n>phi</span><span class=p>,</span><span class=w> </span><span class=n>sensitivity</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>params</span><span class=p>,</span><span class=w> </span><span class=n>dt</span><span class=p>);</span>
</span></code></pre></div></td></tr></table></div> <h2 id=using-sensitivity-providers>Using Sensitivity Providers<a class=headerlink href=#using-sensitivity-providers title="Permanent link">&para;</a></h2> <p>Brahe provides two approaches for computing the sensitivity matrix <span class=arithmatex>\(\partial \mathbf{f}/\partial \mathbf{p}\)</span>---<code>NumericalSensitivity</code> and <code>AnalyticSensitivity</code> classes. The <code>NumericalSensitivity</code> provider computes sensitivities automatically by perturbing parameters, while <code>AnalyticSensitivity</code> allows you to supply analytical derivatives for better performance. When you know the analytical form of <span class=arithmatex>\(\partial \mathbf{f}/\partial \mathbf{p}\)</span>, use <code>AnalyticSensitivity</code> for better accuracy and performance. The example files below demonstrate both numerical and analytical approaches.</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Python</label><label for=__tabbed_1_2>Rust</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1>  1</a></span>
<span class=normal><a href=#__codelineno-2-2>  2</a></span>
<span class=normal><a href=#__codelineno-2-3>  3</a></span>
<span class=normal><a href=#__codelineno-2-4>  4</a></span>
<span class=normal><a href=#__codelineno-2-5>  5</a></span>
<span class=normal><a href=#__codelineno-2-6>  6</a></span>
<span class=normal><a href=#__codelineno-2-7>  7</a></span>
<span class=normal><a href=#__codelineno-2-8>  8</a></span>
<span class=normal><a href=#__codelineno-2-9>  9</a></span>
<span class=normal><a href=#__codelineno-2-10> 10</a></span>
<span class=normal><a href=#__codelineno-2-11> 11</a></span>
<span class=normal><a href=#__codelineno-2-12> 12</a></span>
<span class=normal><a href=#__codelineno-2-13> 13</a></span>
<span class=normal><a href=#__codelineno-2-14> 14</a></span>
<span class=normal><a href=#__codelineno-2-15> 15</a></span>
<span class=normal><a href=#__codelineno-2-16> 16</a></span>
<span class=normal><a href=#__codelineno-2-17> 17</a></span>
<span class=normal><a href=#__codelineno-2-18> 18</a></span>
<span class=normal><a href=#__codelineno-2-19> 19</a></span>
<span class=normal><a href=#__codelineno-2-20> 20</a></span>
<span class=normal><a href=#__codelineno-2-21> 21</a></span>
<span class=normal><a href=#__codelineno-2-22> 22</a></span>
<span class=normal><a href=#__codelineno-2-23> 23</a></span>
<span class=normal><a href=#__codelineno-2-24> 24</a></span>
<span class=normal><a href=#__codelineno-2-25> 25</a></span>
<span class=normal><a href=#__codelineno-2-26> 26</a></span>
<span class=normal><a href=#__codelineno-2-27> 27</a></span>
<span class=normal><a href=#__codelineno-2-28> 28</a></span>
<span class=normal><a href=#__codelineno-2-29> 29</a></span>
<span class=normal><a href=#__codelineno-2-30> 30</a></span>
<span class=normal><a href=#__codelineno-2-31> 31</a></span>
<span class=normal><a href=#__codelineno-2-32> 32</a></span>
<span class=normal><a href=#__codelineno-2-33> 33</a></span>
<span class=normal><a href=#__codelineno-2-34> 34</a></span>
<span class=normal><a href=#__codelineno-2-35> 35</a></span>
<span class=normal><a href=#__codelineno-2-36> 36</a></span>
<span class=normal><a href=#__codelineno-2-37> 37</a></span>
<span class=normal><a href=#__codelineno-2-38> 38</a></span>
<span class=normal><a href=#__codelineno-2-39> 39</a></span>
<span class=normal><a href=#__codelineno-2-40> 40</a></span>
<span class=normal><a href=#__codelineno-2-41> 41</a></span>
<span class=normal><a href=#__codelineno-2-42> 42</a></span>
<span class=normal><a href=#__codelineno-2-43> 43</a></span>
<span class=normal><a href=#__codelineno-2-44> 44</a></span>
<span class=normal><a href=#__codelineno-2-45> 45</a></span>
<span class=normal><a href=#__codelineno-2-46> 46</a></span>
<span class=normal><a href=#__codelineno-2-47> 47</a></span>
<span class=normal><a href=#__codelineno-2-48> 48</a></span>
<span class=normal><a href=#__codelineno-2-49> 49</a></span>
<span class=normal><a href=#__codelineno-2-50> 50</a></span>
<span class=normal><a href=#__codelineno-2-51> 51</a></span>
<span class=normal><a href=#__codelineno-2-52> 52</a></span>
<span class=normal><a href=#__codelineno-2-53> 53</a></span>
<span class=normal><a href=#__codelineno-2-54> 54</a></span>
<span class=normal><a href=#__codelineno-2-55> 55</a></span>
<span class=normal><a href=#__codelineno-2-56> 56</a></span>
<span class=normal><a href=#__codelineno-2-57> 57</a></span>
<span class=normal><a href=#__codelineno-2-58> 58</a></span>
<span class=normal><a href=#__codelineno-2-59> 59</a></span>
<span class=normal><a href=#__codelineno-2-60> 60</a></span>
<span class=normal><a href=#__codelineno-2-61> 61</a></span>
<span class=normal><a href=#__codelineno-2-62> 62</a></span>
<span class=normal><a href=#__codelineno-2-63> 63</a></span>
<span class=normal><a href=#__codelineno-2-64> 64</a></span>
<span class=normal><a href=#__codelineno-2-65> 65</a></span>
<span class=normal><a href=#__codelineno-2-66> 66</a></span>
<span class=normal><a href=#__codelineno-2-67> 67</a></span>
<span class=normal><a href=#__codelineno-2-68> 68</a></span>
<span class=normal><a href=#__codelineno-2-69> 69</a></span>
<span class=normal><a href=#__codelineno-2-70> 70</a></span>
<span class=normal><a href=#__codelineno-2-71> 71</a></span>
<span class=normal><a href=#__codelineno-2-72> 72</a></span>
<span class=normal><a href=#__codelineno-2-73> 73</a></span>
<span class=normal><a href=#__codelineno-2-74> 74</a></span>
<span class=normal><a href=#__codelineno-2-75> 75</a></span>
<span class=normal><a href=#__codelineno-2-76> 76</a></span>
<span class=normal><a href=#__codelineno-2-77> 77</a></span>
<span class=normal><a href=#__codelineno-2-78> 78</a></span>
<span class=normal><a href=#__codelineno-2-79> 79</a></span>
<span class=normal><a href=#__codelineno-2-80> 80</a></span>
<span class=normal><a href=#__codelineno-2-81> 81</a></span>
<span class=normal><a href=#__codelineno-2-82> 82</a></span>
<span class=normal><a href=#__codelineno-2-83> 83</a></span>
<span class=normal><a href=#__codelineno-2-84> 84</a></span>
<span class=normal><a href=#__codelineno-2-85> 85</a></span>
<span class=normal><a href=#__codelineno-2-86> 86</a></span>
<span class=normal><a href=#__codelineno-2-87> 87</a></span>
<span class=normal><a href=#__codelineno-2-88> 88</a></span>
<span class=normal><a href=#__codelineno-2-89> 89</a></span>
<span class=normal><a href=#__codelineno-2-90> 90</a></span>
<span class=normal><a href=#__codelineno-2-91> 91</a></span>
<span class=normal><a href=#__codelineno-2-92> 92</a></span>
<span class=normal><a href=#__codelineno-2-93> 93</a></span>
<span class=normal><a href=#__codelineno-2-94> 94</a></span>
<span class=normal><a href=#__codelineno-2-95> 95</a></span>
<span class=normal><a href=#__codelineno-2-96> 96</a></span>
<span class=normal><a href=#__codelineno-2-97> 97</a></span>
<span class=normal><a href=#__codelineno-2-98> 98</a></span>
<span class=normal><a href=#__codelineno-2-99> 99</a></span>
<span class=normal><a href=#__codelineno-2-100>100</a></span>
<span class=normal><a href=#__codelineno-2-101>101</a></span>
<span class=normal><a href=#__codelineno-2-102>102</a></span>
<span class=normal><a href=#__codelineno-2-103>103</a></span>
<span class=normal><a href=#__codelineno-2-104>104</a></span>
<span class=normal><a href=#__codelineno-2-105>105</a></span>
<span class=normal><a href=#__codelineno-2-106>106</a></span>
<span class=normal><a href=#__codelineno-2-107>107</a></span>
<span class=normal><a href=#__codelineno-2-108>108</a></span>
<span class=normal><a href=#__codelineno-2-109>109</a></span>
<span class=normal><a href=#__codelineno-2-110>110</a></span>
<span class=normal><a href=#__codelineno-2-111>111</a></span>
<span class=normal><a href=#__codelineno-2-112>112</a></span>
<span class=normal><a href=#__codelineno-2-113>113</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1></a><span class=kn>import</span><span class=w> </span><span class=nn>brahe</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>bh</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2></a><span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4></a>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5></a><span class=k>def</span><span class=w> </span><span class=nf>dynamics_with_params</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>state</span><span class=p>,</span> <span class=n>params</span><span class=p>):</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Orbital dynamics with consider parameters.</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7></a>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8></a><span class=sd>    Args:</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9></a><span class=sd>        t: Time</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10></a><span class=sd>        state: [x, y, z, vx, vy, vz]</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11></a><span class=sd>        params: [cd_area_m] - drag coefficient * area / mass</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13></a>    <span class=c1># Extract parameter</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14></a>    <span class=n>cd_area_m</span> <span class=o>=</span> <span class=n>params</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15></a>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16></a>    <span class=c1># Gravitational dynamics</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17></a>    <span class=n>r</span> <span class=o>=</span> <span class=n>state</span><span class=p>[:</span><span class=mi>3</span><span class=p>]</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18></a>    <span class=n>v</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=mi>3</span><span class=p>:]</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19></a>    <span class=n>r_norm</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20></a>    <span class=n>a_grav</span> <span class=o>=</span> <span class=o>-</span><span class=n>bh</span><span class=o>.</span><span class=n>GM_EARTH</span> <span class=o>/</span> <span class=p>(</span><span class=n>r_norm</span><span class=o>**</span><span class=mi>3</span><span class=p>)</span> <span class=o>*</span> <span class=n>r</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21></a>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22></a>    <span class=c1># Atmospheric drag (simplified exponential model)</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23></a>    <span class=n>h</span> <span class=o>=</span> <span class=n>r_norm</span> <span class=o>-</span> <span class=n>bh</span><span class=o>.</span><span class=n>R_EARTH</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24></a>    <span class=n>rho0</span> <span class=o>=</span> <span class=mf>1.225</span>  <span class=c1># kg/m^3 at sea level</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25></a>    <span class=n>H</span> <span class=o>=</span> <span class=mf>8500.0</span>  <span class=c1># Scale height in meters</span>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26></a>    <span class=n>rho</span> <span class=o>=</span> <span class=n>rho0</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>h</span> <span class=o>/</span> <span class=n>H</span><span class=p>)</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27></a>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28></a>    <span class=n>v_norm</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29></a>    <span class=n>a_drag</span> <span class=o>=</span> <span class=o>-</span><span class=mf>0.5</span> <span class=o>*</span> <span class=n>rho</span> <span class=o>*</span> <span class=n>cd_area_m</span> <span class=o>*</span> <span class=n>v_norm</span> <span class=o>*</span> <span class=n>v</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30></a>
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31></a>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>concatenate</span><span class=p>([</span><span class=n>v</span><span class=p>,</span> <span class=n>a_grav</span> <span class=o>+</span> <span class=n>a_drag</span><span class=p>])</span>
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32></a>
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33></a>
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34></a><span class=k>def</span><span class=w> </span><span class=nf>analytical_sensitivity</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>state</span><span class=p>,</span> <span class=n>params</span><span class=p>):</span>
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Analytical sensitivity ∂f/∂p for drag parameter.</span>
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36></a>
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37></a><span class=sd>    Args:</span>
</span><span id=__span-2-38><a id=__codelineno-2-38 name=__codelineno-2-38></a><span class=sd>        t: Time</span>
</span><span id=__span-2-39><a id=__codelineno-2-39 name=__codelineno-2-39></a><span class=sd>        state: [x, y, z, vx, vy, vz]</span>
</span><span id=__span-2-40><a id=__codelineno-2-40 name=__codelineno-2-40></a><span class=sd>        params: [cd_area_m]</span>
</span><span id=__span-2-41><a id=__codelineno-2-41 name=__codelineno-2-41></a>
</span><span id=__span-2-42><a id=__codelineno-2-42 name=__codelineno-2-42></a><span class=sd>    Returns:</span>
</span><span id=__span-2-43><a id=__codelineno-2-43 name=__codelineno-2-43></a><span class=sd>        6x1 sensitivity matrix</span>
</span><span id=__span-2-44><a id=__codelineno-2-44 name=__codelineno-2-44></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-2-45><a id=__codelineno-2-45 name=__codelineno-2-45></a>    <span class=n>r</span> <span class=o>=</span> <span class=n>state</span><span class=p>[:</span><span class=mi>3</span><span class=p>]</span>
</span><span id=__span-2-46><a id=__codelineno-2-46 name=__codelineno-2-46></a>    <span class=n>v</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=mi>3</span><span class=p>:]</span>
</span><span id=__span-2-47><a id=__codelineno-2-47 name=__codelineno-2-47></a>    <span class=n>r_norm</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span><span id=__span-2-48><a id=__codelineno-2-48 name=__codelineno-2-48></a>
</span><span id=__span-2-49><a id=__codelineno-2-49 name=__codelineno-2-49></a>    <span class=c1># Atmospheric density</span>
</span><span id=__span-2-50><a id=__codelineno-2-50 name=__codelineno-2-50></a>    <span class=n>h</span> <span class=o>=</span> <span class=n>r_norm</span> <span class=o>-</span> <span class=n>bh</span><span class=o>.</span><span class=n>R_EARTH</span>
</span><span id=__span-2-51><a id=__codelineno-2-51 name=__codelineno-2-51></a>    <span class=n>rho0</span> <span class=o>=</span> <span class=mf>1.225</span>
</span><span id=__span-2-52><a id=__codelineno-2-52 name=__codelineno-2-52></a>    <span class=n>H</span> <span class=o>=</span> <span class=mf>8500.0</span>
</span><span id=__span-2-53><a id=__codelineno-2-53 name=__codelineno-2-53></a>    <span class=n>rho</span> <span class=o>=</span> <span class=n>rho0</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>h</span> <span class=o>/</span> <span class=n>H</span><span class=p>)</span>
</span><span id=__span-2-54><a id=__codelineno-2-54 name=__codelineno-2-54></a>
</span><span id=__span-2-55><a id=__codelineno-2-55 name=__codelineno-2-55></a>    <span class=n>v_norm</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
</span><span id=__span-2-56><a id=__codelineno-2-56 name=__codelineno-2-56></a>
</span><span id=__span-2-57><a id=__codelineno-2-57 name=__codelineno-2-57></a>    <span class=c1># ∂(state_dot)/∂(cd_area_m)</span>
</span><span id=__span-2-58><a id=__codelineno-2-58 name=__codelineno-2-58></a>    <span class=n>sens</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=mi>6</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span>
</span><span id=__span-2-59><a id=__codelineno-2-59 name=__codelineno-2-59></a>    <span class=k>if</span> <span class=n>v_norm</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-2-60><a id=__codelineno-2-60 name=__codelineno-2-60></a>        <span class=c1># ∂(a_drag)/∂(cd_area_m) = -0.5 * rho * v_norm * v</span>
</span><span id=__span-2-61><a id=__codelineno-2-61 name=__codelineno-2-61></a>        <span class=n>sens</span><span class=p>[</span><span class=mi>3</span><span class=p>:</span><span class=mi>6</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mf>0.5</span> <span class=o>*</span> <span class=n>rho</span> <span class=o>*</span> <span class=n>v_norm</span> <span class=o>*</span> <span class=n>v</span>
</span><span id=__span-2-62><a id=__codelineno-2-62 name=__codelineno-2-62></a>
</span><span id=__span-2-63><a id=__codelineno-2-63 name=__codelineno-2-63></a>    <span class=k>return</span> <span class=n>sens</span>
</span><span id=__span-2-64><a id=__codelineno-2-64 name=__codelineno-2-64></a>
</span><span id=__span-2-65><a id=__codelineno-2-65 name=__codelineno-2-65></a>
</span><span id=__span-2-66><a id=__codelineno-2-66 name=__codelineno-2-66></a><span class=c1># Initial state (400 km LEO circular orbit)</span>
</span><span id=__span-2-67><a id=__codelineno-2-67 name=__codelineno-2-67></a><span class=n>oe</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>bh</span><span class=o>.</span><span class=n>R_EARTH</span> <span class=o>+</span> <span class=mf>250e3</span><span class=p>,</span> <span class=mf>0.001</span><span class=p>,</span> <span class=mf>51.6</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>])</span>
</span><span id=__span-2-68><a id=__codelineno-2-68 name=__codelineno-2-68></a><span class=n>state</span> <span class=o>=</span> <span class=n>bh</span><span class=o>.</span><span class=n>state_osculating_to_cartesian</span><span class=p>(</span><span class=n>oe</span><span class=p>,</span> <span class=n>bh</span><span class=o>.</span><span class=n>AngleFormat</span><span class=o>.</span><span class=n>DEGREES</span><span class=p>)</span>
</span><span id=__span-2-69><a id=__codelineno-2-69 name=__codelineno-2-69></a>
</span><span id=__span-2-70><a id=__codelineno-2-70 name=__codelineno-2-70></a><span class=c1># Consider parameters</span>
</span><span id=__span-2-71><a id=__codelineno-2-71 name=__codelineno-2-71></a><span class=n>params</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.044</span><span class=p>])</span>  <span class=c1># cd_area_m = Cd*A/m = 2.2*10/500</span>
</span><span id=__span-2-72><a id=__codelineno-2-72 name=__codelineno-2-72></a>
</span><span id=__span-2-73><a id=__codelineno-2-73 name=__codelineno-2-73></a><span class=c1># Create numerical sensitivity provider (use class directly as constructor)</span>
</span><span id=__span-2-74><a id=__codelineno-2-74 name=__codelineno-2-74></a><span class=n>numerical_sens</span> <span class=o>=</span> <span class=n>bh</span><span class=o>.</span><span class=n>NumericalSensitivity</span><span class=p>(</span><span class=n>dynamics_with_params</span><span class=p>)</span>
</span><span id=__span-2-75><a id=__codelineno-2-75 name=__codelineno-2-75></a>
</span><span id=__span-2-76><a id=__codelineno-2-76 name=__codelineno-2-76></a><span class=c1># Compute sensitivity matrix numerically</span>
</span><span id=__span-2-77><a id=__codelineno-2-77 name=__codelineno-2-77></a><span class=n>sens_numerical</span> <span class=o>=</span> <span class=n>numerical_sens</span><span class=o>.</span><span class=n>compute</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>state</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
</span><span id=__span-2-78><a id=__codelineno-2-78 name=__codelineno-2-78></a>
</span><span id=__span-2-79><a id=__codelineno-2-79 name=__codelineno-2-79></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Numerical sensitivity (∂f/∂p):&quot;</span><span class=p>)</span>
</span><span id=__span-2-80><a id=__codelineno-2-80 name=__codelineno-2-80></a><span class=nb>print</span><span class=p>(</span>
</span><span id=__span-2-81><a id=__codelineno-2-81 name=__codelineno-2-81></a>    <span class=sa>f</span><span class=s2>&quot;  Position rates: [</span><span class=si>{</span><span class=n>sens_numerical</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>sens_numerical</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>sens_numerical</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>]&quot;</span>
</span><span id=__span-2-82><a id=__codelineno-2-82 name=__codelineno-2-82></a><span class=p>)</span>
</span><span id=__span-2-83><a id=__codelineno-2-83 name=__codelineno-2-83></a><span class=nb>print</span><span class=p>(</span>
</span><span id=__span-2-84><a id=__codelineno-2-84 name=__codelineno-2-84></a>    <span class=sa>f</span><span class=s2>&quot;  Velocity rates: [</span><span class=si>{</span><span class=n>sens_numerical</span><span class=p>[</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>sens_numerical</span><span class=p>[</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>sens_numerical</span><span class=p>[</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>]&quot;</span>
</span><span id=__span-2-85><a id=__codelineno-2-85 name=__codelineno-2-85></a><span class=p>)</span>
</span><span id=__span-2-86><a id=__codelineno-2-86 name=__codelineno-2-86></a>
</span><span id=__span-2-87><a id=__codelineno-2-87 name=__codelineno-2-87></a><span class=c1># Create analytical sensitivity provider</span>
</span><span id=__span-2-88><a id=__codelineno-2-88 name=__codelineno-2-88></a><span class=n>analytic_sens</span> <span class=o>=</span> <span class=n>bh</span><span class=o>.</span><span class=n>AnalyticSensitivity</span><span class=p>(</span><span class=n>analytical_sensitivity</span><span class=p>)</span>
</span><span id=__span-2-89><a id=__codelineno-2-89 name=__codelineno-2-89></a>
</span><span id=__span-2-90><a id=__codelineno-2-90 name=__codelineno-2-90></a><span class=c1># Compute sensitivity matrix analytically</span>
</span><span id=__span-2-91><a id=__codelineno-2-91 name=__codelineno-2-91></a><span class=n>sens_analytical</span> <span class=o>=</span> <span class=n>analytic_sens</span><span class=o>.</span><span class=n>compute</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>state</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
</span><span id=__span-2-92><a id=__codelineno-2-92 name=__codelineno-2-92></a>
</span><span id=__span-2-93><a id=__codelineno-2-93 name=__codelineno-2-93></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Analytical sensitivity (∂f/∂p):&quot;</span><span class=p>)</span>
</span><span id=__span-2-94><a id=__codelineno-2-94 name=__codelineno-2-94></a><span class=nb>print</span><span class=p>(</span>
</span><span id=__span-2-95><a id=__codelineno-2-95 name=__codelineno-2-95></a>    <span class=sa>f</span><span class=s2>&quot;  Position rates: [</span><span class=si>{</span><span class=n>sens_analytical</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>sens_analytical</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>sens_analytical</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>]&quot;</span>
</span><span id=__span-2-96><a id=__codelineno-2-96 name=__codelineno-2-96></a><span class=p>)</span>
</span><span id=__span-2-97><a id=__codelineno-2-97 name=__codelineno-2-97></a><span class=nb>print</span><span class=p>(</span>
</span><span id=__span-2-98><a id=__codelineno-2-98 name=__codelineno-2-98></a>    <span class=sa>f</span><span class=s2>&quot;  Velocity rates: [</span><span class=si>{</span><span class=n>sens_analytical</span><span class=p>[</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>sens_analytical</span><span class=p>[</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>sens_analytical</span><span class=p>[</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>]&quot;</span>
</span><span id=__span-2-99><a id=__codelineno-2-99 name=__codelineno-2-99></a><span class=p>)</span>
</span><span id=__span-2-100><a id=__codelineno-2-100 name=__codelineno-2-100></a>
</span><span id=__span-2-101><a id=__codelineno-2-101 name=__codelineno-2-101></a><span class=c1># Compare numerical and analytical</span>
</span><span id=__span-2-102><a id=__codelineno-2-102 name=__codelineno-2-102></a><span class=n>diff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>sens_numerical</span> <span class=o>-</span> <span class=n>sens_analytical</span><span class=p>)</span>
</span><span id=__span-2-103><a id=__codelineno-2-103 name=__codelineno-2-103></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Max difference: </span><span class=si>{</span><span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>diff</span><span class=p>)</span><span class=si>:</span><span class=s2>.3e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-2-104><a id=__codelineno-2-104 name=__codelineno-2-104></a>
</span><span id=__span-2-105><a id=__codelineno-2-105 name=__codelineno-2-105></a><span class=c1># Numerical sensitivity (∂f/∂p):</span>
</span><span id=__span-2-106><a id=__codelineno-2-106 name=__codelineno-2-106></a><span class=c1>#   Position rates: [0, 0, 0]</span>
</span><span id=__span-2-107><a id=__codelineno-2-107 name=__codelineno-2-107></a><span class=c1>#   Velocity rates: [0, -0.000008425648220011794, -0.000010630522385923769]</span>
</span><span id=__span-2-108><a id=__codelineno-2-108 name=__codelineno-2-108></a>
</span><span id=__span-2-109><a id=__codelineno-2-109 name=__codelineno-2-109></a><span class=c1># Analytical sensitivity (∂f/∂p):</span>
</span><span id=__span-2-110><a id=__codelineno-2-110 name=__codelineno-2-110></a><span class=c1>#   Position rates: [0, 0, 0]</span>
</span><span id=__span-2-111><a id=__codelineno-2-111 name=__codelineno-2-111></a><span class=c1>#   Velocity rates: [0, -0.000008425648218908737, -0.00001063052238539645]</span>
</span><span id=__span-2-112><a id=__codelineno-2-112 name=__codelineno-2-112></a>
</span><span id=__span-2-113><a id=__codelineno-2-113 name=__codelineno-2-113></a><span class=c1># Max difference: 1.103e-15</span>
</span></code></pre></div></td></tr></table></div> </div> <div class=tabbed-block> <div class="language-rust highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1>  1</a></span>
<span class=normal><a href=#__codelineno-3-2>  2</a></span>
<span class=normal><a href=#__codelineno-3-3>  3</a></span>
<span class=normal><a href=#__codelineno-3-4>  4</a></span>
<span class=normal><a href=#__codelineno-3-5>  5</a></span>
<span class=normal><a href=#__codelineno-3-6>  6</a></span>
<span class=normal><a href=#__codelineno-3-7>  7</a></span>
<span class=normal><a href=#__codelineno-3-8>  8</a></span>
<span class=normal><a href=#__codelineno-3-9>  9</a></span>
<span class=normal><a href=#__codelineno-3-10> 10</a></span>
<span class=normal><a href=#__codelineno-3-11> 11</a></span>
<span class=normal><a href=#__codelineno-3-12> 12</a></span>
<span class=normal><a href=#__codelineno-3-13> 13</a></span>
<span class=normal><a href=#__codelineno-3-14> 14</a></span>
<span class=normal><a href=#__codelineno-3-15> 15</a></span>
<span class=normal><a href=#__codelineno-3-16> 16</a></span>
<span class=normal><a href=#__codelineno-3-17> 17</a></span>
<span class=normal><a href=#__codelineno-3-18> 18</a></span>
<span class=normal><a href=#__codelineno-3-19> 19</a></span>
<span class=normal><a href=#__codelineno-3-20> 20</a></span>
<span class=normal><a href=#__codelineno-3-21> 21</a></span>
<span class=normal><a href=#__codelineno-3-22> 22</a></span>
<span class=normal><a href=#__codelineno-3-23> 23</a></span>
<span class=normal><a href=#__codelineno-3-24> 24</a></span>
<span class=normal><a href=#__codelineno-3-25> 25</a></span>
<span class=normal><a href=#__codelineno-3-26> 26</a></span>
<span class=normal><a href=#__codelineno-3-27> 27</a></span>
<span class=normal><a href=#__codelineno-3-28> 28</a></span>
<span class=normal><a href=#__codelineno-3-29> 29</a></span>
<span class=normal><a href=#__codelineno-3-30> 30</a></span>
<span class=normal><a href=#__codelineno-3-31> 31</a></span>
<span class=normal><a href=#__codelineno-3-32> 32</a></span>
<span class=normal><a href=#__codelineno-3-33> 33</a></span>
<span class=normal><a href=#__codelineno-3-34> 34</a></span>
<span class=normal><a href=#__codelineno-3-35> 35</a></span>
<span class=normal><a href=#__codelineno-3-36> 36</a></span>
<span class=normal><a href=#__codelineno-3-37> 37</a></span>
<span class=normal><a href=#__codelineno-3-38> 38</a></span>
<span class=normal><a href=#__codelineno-3-39> 39</a></span>
<span class=normal><a href=#__codelineno-3-40> 40</a></span>
<span class=normal><a href=#__codelineno-3-41> 41</a></span>
<span class=normal><a href=#__codelineno-3-42> 42</a></span>
<span class=normal><a href=#__codelineno-3-43> 43</a></span>
<span class=normal><a href=#__codelineno-3-44> 44</a></span>
<span class=normal><a href=#__codelineno-3-45> 45</a></span>
<span class=normal><a href=#__codelineno-3-46> 46</a></span>
<span class=normal><a href=#__codelineno-3-47> 47</a></span>
<span class=normal><a href=#__codelineno-3-48> 48</a></span>
<span class=normal><a href=#__codelineno-3-49> 49</a></span>
<span class=normal><a href=#__codelineno-3-50> 50</a></span>
<span class=normal><a href=#__codelineno-3-51> 51</a></span>
<span class=normal><a href=#__codelineno-3-52> 52</a></span>
<span class=normal><a href=#__codelineno-3-53> 53</a></span>
<span class=normal><a href=#__codelineno-3-54> 54</a></span>
<span class=normal><a href=#__codelineno-3-55> 55</a></span>
<span class=normal><a href=#__codelineno-3-56> 56</a></span>
<span class=normal><a href=#__codelineno-3-57> 57</a></span>
<span class=normal><a href=#__codelineno-3-58> 58</a></span>
<span class=normal><a href=#__codelineno-3-59> 59</a></span>
<span class=normal><a href=#__codelineno-3-60> 60</a></span>
<span class=normal><a href=#__codelineno-3-61> 61</a></span>
<span class=normal><a href=#__codelineno-3-62> 62</a></span>
<span class=normal><a href=#__codelineno-3-63> 63</a></span>
<span class=normal><a href=#__codelineno-3-64> 64</a></span>
<span class=normal><a href=#__codelineno-3-65> 65</a></span>
<span class=normal><a href=#__codelineno-3-66> 66</a></span>
<span class=normal><a href=#__codelineno-3-67> 67</a></span>
<span class=normal><a href=#__codelineno-3-68> 68</a></span>
<span class=normal><a href=#__codelineno-3-69> 69</a></span>
<span class=normal><a href=#__codelineno-3-70> 70</a></span>
<span class=normal><a href=#__codelineno-3-71> 71</a></span>
<span class=normal><a href=#__codelineno-3-72> 72</a></span>
<span class=normal><a href=#__codelineno-3-73> 73</a></span>
<span class=normal><a href=#__codelineno-3-74> 74</a></span>
<span class=normal><a href=#__codelineno-3-75> 75</a></span>
<span class=normal><a href=#__codelineno-3-76> 76</a></span>
<span class=normal><a href=#__codelineno-3-77> 77</a></span>
<span class=normal><a href=#__codelineno-3-78> 78</a></span>
<span class=normal><a href=#__codelineno-3-79> 79</a></span>
<span class=normal><a href=#__codelineno-3-80> 80</a></span>
<span class=normal><a href=#__codelineno-3-81> 81</a></span>
<span class=normal><a href=#__codelineno-3-82> 82</a></span>
<span class=normal><a href=#__codelineno-3-83> 83</a></span>
<span class=normal><a href=#__codelineno-3-84> 84</a></span>
<span class=normal><a href=#__codelineno-3-85> 85</a></span>
<span class=normal><a href=#__codelineno-3-86> 86</a></span>
<span class=normal><a href=#__codelineno-3-87> 87</a></span>
<span class=normal><a href=#__codelineno-3-88> 88</a></span>
<span class=normal><a href=#__codelineno-3-89> 89</a></span>
<span class=normal><a href=#__codelineno-3-90> 90</a></span>
<span class=normal><a href=#__codelineno-3-91> 91</a></span>
<span class=normal><a href=#__codelineno-3-92> 92</a></span>
<span class=normal><a href=#__codelineno-3-93> 93</a></span>
<span class=normal><a href=#__codelineno-3-94> 94</a></span>
<span class=normal><a href=#__codelineno-3-95> 95</a></span>
<span class=normal><a href=#__codelineno-3-96> 96</a></span>
<span class=normal><a href=#__codelineno-3-97> 97</a></span>
<span class=normal><a href=#__codelineno-3-98> 98</a></span>
<span class=normal><a href=#__codelineno-3-99> 99</a></span>
<span class=normal><a href=#__codelineno-3-100>100</a></span>
<span class=normal><a href=#__codelineno-3-101>101</a></span>
<span class=normal><a href=#__codelineno-3-102>102</a></span>
<span class=normal><a href=#__codelineno-3-103>103</a></span>
<span class=normal><a href=#__codelineno-3-104>104</a></span>
<span class=normal><a href=#__codelineno-3-105>105</a></span>
<span class=normal><a href=#__codelineno-3-106>106</a></span>
<span class=normal><a href=#__codelineno-3-107>107</a></span>
<span class=normal><a href=#__codelineno-3-108>108</a></span>
<span class=normal><a href=#__codelineno-3-109>109</a></span>
<span class=normal><a href=#__codelineno-3-110>110</a></span>
<span class=normal><a href=#__codelineno-3-111>111</a></span>
<span class=normal><a href=#__codelineno-3-112>112</a></span>
<span class=normal><a href=#__codelineno-3-113>113</a></span>
<span class=normal><a href=#__codelineno-3-114>114</a></span>
<span class=normal><a href=#__codelineno-3-115>115</a></span>
<span class=normal><a href=#__codelineno-3-116>116</a></span>
<span class=normal><a href=#__codelineno-3-117>117</a></span>
<span class=normal><a href=#__codelineno-3-118>118</a></span>
<span class=normal><a href=#__codelineno-3-119>119</a></span>
<span class=normal><a href=#__codelineno-3-120>120</a></span>
<span class=normal><a href=#__codelineno-3-121>121</a></span>
<span class=normal><a href=#__codelineno-3-122>122</a></span>
<span class=normal><a href=#__codelineno-3-123>123</a></span>
<span class=normal><a href=#__codelineno-3-124>124</a></span>
<span class=normal><a href=#__codelineno-3-125>125</a></span>
<span class=normal><a href=#__codelineno-3-126>126</a></span>
<span class=normal><a href=#__codelineno-3-127>127</a></span>
<span class=normal><a href=#__codelineno-3-128>128</a></span>
<span class=normal><a href=#__codelineno-3-129>129</a></span>
<span class=normal><a href=#__codelineno-3-130>130</a></span>
<span class=normal><a href=#__codelineno-3-131>131</a></span>
<span class=normal><a href=#__codelineno-3-132>132</a></span>
<span class=normal><a href=#__codelineno-3-133>133</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1></a><span class=k>use</span><span class=w> </span><span class=n>brahe</span><span class=p>::</span><span class=n>constants</span><span class=p>::{</span><span class=n>GM_EARTH</span><span class=p>,</span><span class=w> </span><span class=n>R_EARTH</span><span class=p>};</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2></a><span class=k>use</span><span class=w> </span><span class=n>brahe</span><span class=p>::</span><span class=n>math</span><span class=p>::</span><span class=n>sensitivity</span><span class=p>::{</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3></a><span class=w>    </span><span class=n>DAnalyticSensitivity</span><span class=p>,</span><span class=w> </span><span class=n>DNumericalSensitivity</span><span class=p>,</span><span class=w> </span><span class=n>DSensitivityProvider</span><span class=p>,</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4></a><span class=p>};</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5></a><span class=k>use</span><span class=w> </span><span class=n>brahe</span><span class=p>::</span><span class=n>state_osculating_to_cartesian</span><span class=p>;</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6></a><span class=k>use</span><span class=w> </span><span class=n>brahe</span><span class=p>::</span><span class=n>AngleFormat</span><span class=p>;</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7></a><span class=k>use</span><span class=w> </span><span class=n>nalgebra</span><span class=p>::{</span><span class=n>DMatrix</span><span class=p>,</span><span class=w> </span><span class=n>DVector</span><span class=p>,</span><span class=w> </span><span class=n>SVector</span><span class=p>};</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8></a>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9></a><span class=k>fn</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10></a><span class=w>    </span><span class=c1>// Dynamics function that takes consider parameters</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dynamics</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>|</span><span class=n>_t</span><span class=p>:</span><span class=w> </span><span class=kt>f64</span><span class=p>,</span><span class=w> </span><span class=n>state</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>params</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;|</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>cd_area_m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>params</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13></a>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>fixed_rows</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>fixed_rows</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>norm</span><span class=p>();</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17></a>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18></a><span class=w>        </span><span class=c1>// Gravitational acceleration</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>a_grav</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>-</span><span class=n>GM_EARTH</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=p>(</span><span class=n>r_norm</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>r_norm</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>r</span><span class=p>;</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20></a>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21></a><span class=w>        </span><span class=c1>// Atmospheric drag (simplified exponential model)</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>R_EARTH</span><span class=p>;</span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>rho0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1.225</span><span class=p>;</span><span class=w> </span><span class=c1>// kg/m^3</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>scale_height</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>8500.0</span><span class=p>;</span><span class=w> </span><span class=c1>// m</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>rho</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rho0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=o>-</span><span class=n>h</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>scale_height</span><span class=p>).</span><span class=n>exp</span><span class=p>();</span>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26></a>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>norm</span><span class=p>();</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>a_drag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0.0</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29></a><span class=w>            </span><span class=o>-</span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>rho</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>cd_area_m</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30></a><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31></a><span class=w>            </span><span class=n>nalgebra</span><span class=p>::</span><span class=n>Vector3</span><span class=p>::</span><span class=n>zeros</span><span class=p>()</span>
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32></a><span class=w>        </span><span class=p>};</span>
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33></a>
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>state_dot</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>::</span><span class=n>zeros</span><span class=p>(</span><span class=mi>6</span><span class=p>);</span>
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35></a><span class=w>        </span><span class=n>state_dot</span>
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36></a><span class=w>            </span><span class=p>.</span><span class=n>fixed_rows_mut</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37></a><span class=w>            </span><span class=p>.</span><span class=n>copy_from</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v</span><span class=p>.</span><span class=n>clone_owned</span><span class=p>());</span>
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38></a><span class=w>        </span><span class=n>state_dot</span>
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39></a><span class=w>            </span><span class=p>.</span><span class=n>fixed_rows_mut</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40></a><span class=w>            </span><span class=p>.</span><span class=n>copy_from</span><span class=p>(</span><span class=o>&amp;</span><span class=p>(</span><span class=n>a_grav</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>a_drag</span><span class=p>));</span>
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41></a><span class=w>        </span><span class=n>state_dot</span>
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43></a>
</span><span id=__span-3-44><a id=__codelineno-3-44 name=__codelineno-3-44></a><span class=w>    </span><span class=c1>// Analytical sensitivity function</span>
</span><span id=__span-3-45><a id=__codelineno-3-45 name=__codelineno-3-45></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>analytical_sensitivity</span><span class=w> </span><span class=o>=</span>
</span><span id=__span-3-46><a id=__codelineno-3-46 name=__codelineno-3-46></a><span class=w>        </span><span class=o>|</span><span class=n>_t</span><span class=p>:</span><span class=w> </span><span class=kt>f64</span><span class=p>,</span><span class=w> </span><span class=n>state</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>_params</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;|</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>DMatrix</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-47><a id=__codelineno-3-47 name=__codelineno-3-47></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>fixed_rows</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-3-48><a id=__codelineno-3-48 name=__codelineno-3-48></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>fixed_rows</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span>
</span><span id=__span-3-49><a id=__codelineno-3-49 name=__codelineno-3-49></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>norm</span><span class=p>();</span>
</span><span id=__span-3-50><a id=__codelineno-3-50 name=__codelineno-3-50></a>
</span><span id=__span-3-51><a id=__codelineno-3-51 name=__codelineno-3-51></a><span class=w>            </span><span class=c1>// Atmospheric density</span>
</span><span id=__span-3-52><a id=__codelineno-3-52 name=__codelineno-3-52></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>R_EARTH</span><span class=p>;</span>
</span><span id=__span-3-53><a id=__codelineno-3-53 name=__codelineno-3-53></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>rho0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1.225</span><span class=p>;</span>
</span><span id=__span-3-54><a id=__codelineno-3-54 name=__codelineno-3-54></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>scale_height</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>8500.0</span><span class=p>;</span>
</span><span id=__span-3-55><a id=__codelineno-3-55 name=__codelineno-3-55></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>rho</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rho0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=o>-</span><span class=n>h</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>scale_height</span><span class=p>).</span><span class=n>exp</span><span class=p>();</span>
</span><span id=__span-3-56><a id=__codelineno-3-56 name=__codelineno-3-56></a>
</span><span id=__span-3-57><a id=__codelineno-3-57 name=__codelineno-3-57></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>norm</span><span class=p>();</span>
</span><span id=__span-3-58><a id=__codelineno-3-58 name=__codelineno-3-58></a>
</span><span id=__span-3-59><a id=__codelineno-3-59 name=__codelineno-3-59></a><span class=w>            </span><span class=c1>// ∂(state_dot)/∂(cd_area_m)</span>
</span><span id=__span-3-60><a id=__codelineno-3-60 name=__codelineno-3-60></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>sens</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DMatrix</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>::</span><span class=n>zeros</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-3-61><a id=__codelineno-3-61 name=__codelineno-3-61></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0.0</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-62><a id=__codelineno-3-62 name=__codelineno-3-62></a><span class=w>                </span><span class=c1>// ∂(a_drag)/∂(cd_area_m) = -0.5 * rho * v_norm * v</span>
</span><span id=__span-3-63><a id=__codelineno-3-63 name=__codelineno-3-63></a><span class=w>                </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=mi>3</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-64><a id=__codelineno-3-64 name=__codelineno-3-64></a><span class=w>                    </span><span class=n>sens</span><span class=p>[(</span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>-</span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>rho</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span><span id=__span-3-65><a id=__codelineno-3-65 name=__codelineno-3-65></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-3-66><a id=__codelineno-3-66 name=__codelineno-3-66></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-3-67><a id=__codelineno-3-67 name=__codelineno-3-67></a>
</span><span id=__span-3-68><a id=__codelineno-3-68 name=__codelineno-3-68></a><span class=w>            </span><span class=n>sens</span>
</span><span id=__span-3-69><a id=__codelineno-3-69 name=__codelineno-3-69></a><span class=w>        </span><span class=p>};</span>
</span><span id=__span-3-70><a id=__codelineno-3-70 name=__codelineno-3-70></a>
</span><span id=__span-3-71><a id=__codelineno-3-71 name=__codelineno-3-71></a><span class=w>    </span><span class=c1>// Initial state (400 km LEO circular orbit)</span>
</span><span id=__span-3-72><a id=__codelineno-3-72 name=__codelineno-3-72></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>oe</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SVector</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=o>&gt;</span><span class=p>::</span><span class=n>from_row_slice</span><span class=p>(</span><span class=o>&amp;</span><span class=p>[</span><span class=n>R_EARTH</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>250e3</span><span class=p>,</span><span class=w> </span><span class=mf>0.001</span><span class=p>,</span><span class=w> </span><span class=mf>51.6</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>]);</span>
</span><span id=__span-3-73><a id=__codelineno-3-73 name=__codelineno-3-73></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>state_vec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state_osculating_to_cartesian</span><span class=p>(</span><span class=n>oe</span><span class=p>,</span><span class=w> </span><span class=n>AngleFormat</span><span class=p>::</span><span class=n>Degrees</span><span class=p>);</span>
</span><span id=__span-3-74><a id=__codelineno-3-74 name=__codelineno-3-74></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=n>from_iterator</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=n>state_vec</span><span class=p>.</span><span class=n>iter</span><span class=p>().</span><span class=n>copied</span><span class=p>());</span>
</span><span id=__span-3-75><a id=__codelineno-3-75 name=__codelineno-3-75></a>
</span><span id=__span-3-76><a id=__codelineno-3-76 name=__codelineno-3-76></a><span class=w>    </span><span class=c1>// Consider parameters</span>
</span><span id=__span-3-77><a id=__codelineno-3-77 name=__codelineno-3-77></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>params</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=n>from_vec</span><span class=p>(</span><span class=fm>vec!</span><span class=p>[</span><span class=mf>0.044</span><span class=p>]);</span><span class=w> </span><span class=c1>// cd_area_m = Cd*A/m = 2.2*10/500</span>
</span><span id=__span-3-78><a id=__codelineno-3-78 name=__codelineno-3-78></a>
</span><span id=__span-3-79><a id=__codelineno-3-79 name=__codelineno-3-79></a><span class=w>    </span><span class=c1>// Create numerical sensitivity provider</span>
</span><span id=__span-3-80><a id=__codelineno-3-80 name=__codelineno-3-80></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>numerical_sens</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DNumericalSensitivity</span><span class=p>::</span><span class=n>central</span><span class=p>(</span><span class=nb>Box</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>dynamics</span><span class=p>.</span><span class=n>clone</span><span class=p>()));</span>
</span><span id=__span-3-81><a id=__codelineno-3-81 name=__codelineno-3-81></a>
</span><span id=__span-3-82><a id=__codelineno-3-82 name=__codelineno-3-82></a><span class=w>    </span><span class=c1>// Compute sensitivity matrix numerically</span>
</span><span id=__span-3-83><a id=__codelineno-3-83 name=__codelineno-3-83></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>sens_numerical</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>numerical_sens</span><span class=p>.</span><span class=n>compute</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>params</span><span class=p>);</span>
</span><span id=__span-3-84><a id=__codelineno-3-84 name=__codelineno-3-84></a>
</span><span id=__span-3-85><a id=__codelineno-3-85 name=__codelineno-3-85></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;Numerical sensitivity (∂f/∂p):&quot;</span><span class=p>);</span>
</span><span id=__span-3-86><a id=__codelineno-3-86 name=__codelineno-3-86></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span>
</span><span id=__span-3-87><a id=__codelineno-3-87 name=__codelineno-3-87></a><span class=w>        </span><span class=s>&quot;  Position rates: [{}, {}, {}]&quot;</span><span class=p>,</span>
</span><span id=__span-3-88><a id=__codelineno-3-88 name=__codelineno-3-88></a><span class=w>        </span><span class=n>sens_numerical</span><span class=p>[(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)],</span>
</span><span id=__span-3-89><a id=__codelineno-3-89 name=__codelineno-3-89></a><span class=w>        </span><span class=n>sens_numerical</span><span class=p>[(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)],</span>
</span><span id=__span-3-90><a id=__codelineno-3-90 name=__codelineno-3-90></a><span class=w>        </span><span class=n>sens_numerical</span><span class=p>[(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]</span>
</span><span id=__span-3-91><a id=__codelineno-3-91 name=__codelineno-3-91></a><span class=w>    </span><span class=p>);</span>
</span><span id=__span-3-92><a id=__codelineno-3-92 name=__codelineno-3-92></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span>
</span><span id=__span-3-93><a id=__codelineno-3-93 name=__codelineno-3-93></a><span class=w>        </span><span class=s>&quot;  Velocity rates: [{}, {}, {}]&quot;</span><span class=p>,</span>
</span><span id=__span-3-94><a id=__codelineno-3-94 name=__codelineno-3-94></a><span class=w>        </span><span class=n>sens_numerical</span><span class=p>[(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)],</span>
</span><span id=__span-3-95><a id=__codelineno-3-95 name=__codelineno-3-95></a><span class=w>        </span><span class=n>sens_numerical</span><span class=p>[(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)],</span>
</span><span id=__span-3-96><a id=__codelineno-3-96 name=__codelineno-3-96></a><span class=w>        </span><span class=n>sens_numerical</span><span class=p>[(</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]</span>
</span><span id=__span-3-97><a id=__codelineno-3-97 name=__codelineno-3-97></a><span class=w>    </span><span class=p>);</span>
</span><span id=__span-3-98><a id=__codelineno-3-98 name=__codelineno-3-98></a>
</span><span id=__span-3-99><a id=__codelineno-3-99 name=__codelineno-3-99></a><span class=w>    </span><span class=c1>// Create analytical sensitivity provider</span>
</span><span id=__span-3-100><a id=__codelineno-3-100 name=__codelineno-3-100></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>analytic_sens</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DAnalyticSensitivity</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=nb>Box</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>analytical_sensitivity</span><span class=p>));</span>
</span><span id=__span-3-101><a id=__codelineno-3-101 name=__codelineno-3-101></a>
</span><span id=__span-3-102><a id=__codelineno-3-102 name=__codelineno-3-102></a><span class=w>    </span><span class=c1>// Compute sensitivity matrix analytically</span>
</span><span id=__span-3-103><a id=__codelineno-3-103 name=__codelineno-3-103></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>sens_analytical</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>analytic_sens</span><span class=p>.</span><span class=n>compute</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>params</span><span class=p>);</span>
</span><span id=__span-3-104><a id=__codelineno-3-104 name=__codelineno-3-104></a>
</span><span id=__span-3-105><a id=__codelineno-3-105 name=__codelineno-3-105></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;</span><span class=se>\n</span><span class=s>Analytical sensitivity (∂f/∂p):&quot;</span><span class=p>);</span>
</span><span id=__span-3-106><a id=__codelineno-3-106 name=__codelineno-3-106></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span>
</span><span id=__span-3-107><a id=__codelineno-3-107 name=__codelineno-3-107></a><span class=w>        </span><span class=s>&quot;  Position rates: [{}, {}, {}]&quot;</span><span class=p>,</span>
</span><span id=__span-3-108><a id=__codelineno-3-108 name=__codelineno-3-108></a><span class=w>        </span><span class=n>sens_analytical</span><span class=p>[(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)],</span>
</span><span id=__span-3-109><a id=__codelineno-3-109 name=__codelineno-3-109></a><span class=w>        </span><span class=n>sens_analytical</span><span class=p>[(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)],</span>
</span><span id=__span-3-110><a id=__codelineno-3-110 name=__codelineno-3-110></a><span class=w>        </span><span class=n>sens_analytical</span><span class=p>[(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]</span>
</span><span id=__span-3-111><a id=__codelineno-3-111 name=__codelineno-3-111></a><span class=w>    </span><span class=p>);</span>
</span><span id=__span-3-112><a id=__codelineno-3-112 name=__codelineno-3-112></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span>
</span><span id=__span-3-113><a id=__codelineno-3-113 name=__codelineno-3-113></a><span class=w>        </span><span class=s>&quot;  Velocity rates: [{}, {}, {}]&quot;</span><span class=p>,</span>
</span><span id=__span-3-114><a id=__codelineno-3-114 name=__codelineno-3-114></a><span class=w>        </span><span class=n>sens_analytical</span><span class=p>[(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)],</span>
</span><span id=__span-3-115><a id=__codelineno-3-115 name=__codelineno-3-115></a><span class=w>        </span><span class=n>sens_analytical</span><span class=p>[(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)],</span>
</span><span id=__span-3-116><a id=__codelineno-3-116 name=__codelineno-3-116></a><span class=w>        </span><span class=n>sens_analytical</span><span class=p>[(</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]</span>
</span><span id=__span-3-117><a id=__codelineno-3-117 name=__codelineno-3-117></a><span class=w>    </span><span class=p>);</span>
</span><span id=__span-3-118><a id=__codelineno-3-118 name=__codelineno-3-118></a>
</span><span id=__span-3-119><a id=__codelineno-3-119 name=__codelineno-3-119></a><span class=w>    </span><span class=c1>// Compare numerical and analytical</span>
</span><span id=__span-3-120><a id=__codelineno-3-120 name=__codelineno-3-120></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>diff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>sens_numerical</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=o>&amp;</span><span class=n>sens_analytical</span><span class=p>;</span>
</span><span id=__span-3-121><a id=__codelineno-3-121 name=__codelineno-3-121></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>max_diff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>diff</span><span class=p>.</span><span class=n>abs</span><span class=p>().</span><span class=n>max</span><span class=p>();</span>
</span><span id=__span-3-122><a id=__codelineno-3-122 name=__codelineno-3-122></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;</span><span class=se>\n</span><span class=s>Max difference: {:.3e}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>max_diff</span><span class=p>);</span>
</span><span id=__span-3-123><a id=__codelineno-3-123 name=__codelineno-3-123></a><span class=p>}</span>
</span><span id=__span-3-124><a id=__codelineno-3-124 name=__codelineno-3-124></a>
</span><span id=__span-3-125><a id=__codelineno-3-125 name=__codelineno-3-125></a><span class=c1>// Numerical sensitivity (∂f/∂p):</span>
</span><span id=__span-3-126><a id=__codelineno-3-126 name=__codelineno-3-126></a><span class=c1>//   Position rates: [0, 0, 0]</span>
</span><span id=__span-3-127><a id=__codelineno-3-127 name=__codelineno-3-127></a><span class=c1>//   Velocity rates: [0, -0.000008425648220011794, -0.000010630522385923769]</span>
</span><span id=__span-3-128><a id=__codelineno-3-128 name=__codelineno-3-128></a>
</span><span id=__span-3-129><a id=__codelineno-3-129 name=__codelineno-3-129></a><span class=c1>// Analytical sensitivity (∂f/∂p):</span>
</span><span id=__span-3-130><a id=__codelineno-3-130 name=__codelineno-3-130></a><span class=c1>//   Position rates: [0, 0, 0]</span>
</span><span id=__span-3-131><a id=__codelineno-3-131 name=__codelineno-3-131></a><span class=c1>//   Velocity rates: [0, -0.000008425648218908737, -0.00001063052238539645]</span>
</span><span id=__span-3-132><a id=__codelineno-3-132 name=__codelineno-3-132></a>
</span><span id=__span-3-133><a id=__codelineno-3-133 name=__codelineno-3-133></a><span class=c1>// Max difference: 1.103e-15</span>
</span></code></pre></div></td></tr></table></div> </div> </div> </div> <h3 id=when-to-use-analytical-sensitivity>When to Use Analytical Sensitivity<a class=headerlink href=#when-to-use-analytical-sensitivity title="Permanent link">&para;</a></h3> <p>Use analytical sensitivity when:</p> <ul> <li>Derivatives <span class=arithmatex>\(\partial \mathbf{f}/\partial \mathbf{p}\)</span> are simple to derive (e.g., drag coefficient, solar radiation pressure coefficient)</li> <li>Maximum accuracy is required (no finite difference errors)</li> <li>Sensitivity will be computed many times (performance critical)</li> <li>Working with well-understood parameter dependencies</li> </ul> <div class="admonition tip"> <p class=admonition-title>Recommendation</p> <p>For common parameters like atmospheric drag coefficient or solar radiation pressure coefficient, the analytical derivatives are often straightforward. When analytical forms are available, they provide better accuracy and performance than numerical approximations.</p> </div> <h3 id=perturbation-strategies>Perturbation Strategies<a class=headerlink href=#perturbation-strategies title="Permanent link">&para;</a></h3> <p>The <code>NumericalSensitivity</code> provider uses the same perturbation strategies as <code>NumericalJacobian</code>:</p> <ul> <li><strong>Fixed perturbation</strong>: Constant step size for all parameters</li> <li><strong>Percentage perturbation</strong>: Scale by parameter magnitude</li> <li><strong>Adaptive perturbation</strong>: Balance accuracy and robustness</li> </ul> <p>See the <a href=../mathematics/jacobian.html#perturbation-strategies>Jacobian Computation</a> guide for detailed information on configuring perturbation strategies.</p> <h2 id=integrating-sensitivity-matrices>Integrating Sensitivity Matrices<a class=headerlink href=#integrating-sensitivity-matrices title="Permanent link">&para;</a></h2> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>Python</label><label for=__tabbed_2_2>Rust</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1>  1</a></span>
<span class=normal><a href=#__codelineno-4-2>  2</a></span>
<span class=normal><a href=#__codelineno-4-3>  3</a></span>
<span class=normal><a href=#__codelineno-4-4>  4</a></span>
<span class=normal><a href=#__codelineno-4-5>  5</a></span>
<span class=normal><a href=#__codelineno-4-6>  6</a></span>
<span class=normal><a href=#__codelineno-4-7>  7</a></span>
<span class=normal><a href=#__codelineno-4-8>  8</a></span>
<span class=normal><a href=#__codelineno-4-9>  9</a></span>
<span class=normal><a href=#__codelineno-4-10> 10</a></span>
<span class=normal><a href=#__codelineno-4-11> 11</a></span>
<span class=normal><a href=#__codelineno-4-12> 12</a></span>
<span class=normal><a href=#__codelineno-4-13> 13</a></span>
<span class=normal><a href=#__codelineno-4-14> 14</a></span>
<span class=normal><a href=#__codelineno-4-15> 15</a></span>
<span class=normal><a href=#__codelineno-4-16> 16</a></span>
<span class=normal><a href=#__codelineno-4-17> 17</a></span>
<span class=normal><a href=#__codelineno-4-18> 18</a></span>
<span class=normal><a href=#__codelineno-4-19> 19</a></span>
<span class=normal><a href=#__codelineno-4-20> 20</a></span>
<span class=normal><a href=#__codelineno-4-21> 21</a></span>
<span class=normal><a href=#__codelineno-4-22> 22</a></span>
<span class=normal><a href=#__codelineno-4-23> 23</a></span>
<span class=normal><a href=#__codelineno-4-24> 24</a></span>
<span class=normal><a href=#__codelineno-4-25> 25</a></span>
<span class=normal><a href=#__codelineno-4-26> 26</a></span>
<span class=normal><a href=#__codelineno-4-27> 27</a></span>
<span class=normal><a href=#__codelineno-4-28> 28</a></span>
<span class=normal><a href=#__codelineno-4-29> 29</a></span>
<span class=normal><a href=#__codelineno-4-30> 30</a></span>
<span class=normal><a href=#__codelineno-4-31> 31</a></span>
<span class=normal><a href=#__codelineno-4-32> 32</a></span>
<span class=normal><a href=#__codelineno-4-33> 33</a></span>
<span class=normal><a href=#__codelineno-4-34> 34</a></span>
<span class=normal><a href=#__codelineno-4-35> 35</a></span>
<span class=normal><a href=#__codelineno-4-36> 36</a></span>
<span class=normal><a href=#__codelineno-4-37> 37</a></span>
<span class=normal><a href=#__codelineno-4-38> 38</a></span>
<span class=normal><a href=#__codelineno-4-39> 39</a></span>
<span class=normal><a href=#__codelineno-4-40> 40</a></span>
<span class=normal><a href=#__codelineno-4-41> 41</a></span>
<span class=normal><a href=#__codelineno-4-42> 42</a></span>
<span class=normal><a href=#__codelineno-4-43> 43</a></span>
<span class=normal><a href=#__codelineno-4-44> 44</a></span>
<span class=normal><a href=#__codelineno-4-45> 45</a></span>
<span class=normal><a href=#__codelineno-4-46> 46</a></span>
<span class=normal><a href=#__codelineno-4-47> 47</a></span>
<span class=normal><a href=#__codelineno-4-48> 48</a></span>
<span class=normal><a href=#__codelineno-4-49> 49</a></span>
<span class=normal><a href=#__codelineno-4-50> 50</a></span>
<span class=normal><a href=#__codelineno-4-51> 51</a></span>
<span class=normal><a href=#__codelineno-4-52> 52</a></span>
<span class=normal><a href=#__codelineno-4-53> 53</a></span>
<span class=normal><a href=#__codelineno-4-54> 54</a></span>
<span class=normal><a href=#__codelineno-4-55> 55</a></span>
<span class=normal><a href=#__codelineno-4-56> 56</a></span>
<span class=normal><a href=#__codelineno-4-57> 57</a></span>
<span class=normal><a href=#__codelineno-4-58> 58</a></span>
<span class=normal><a href=#__codelineno-4-59> 59</a></span>
<span class=normal><a href=#__codelineno-4-60> 60</a></span>
<span class=normal><a href=#__codelineno-4-61> 61</a></span>
<span class=normal><a href=#__codelineno-4-62> 62</a></span>
<span class=normal><a href=#__codelineno-4-63> 63</a></span>
<span class=normal><a href=#__codelineno-4-64> 64</a></span>
<span class=normal><a href=#__codelineno-4-65> 65</a></span>
<span class=normal><a href=#__codelineno-4-66> 66</a></span>
<span class=normal><a href=#__codelineno-4-67> 67</a></span>
<span class=normal><a href=#__codelineno-4-68> 68</a></span>
<span class=normal><a href=#__codelineno-4-69> 69</a></span>
<span class=normal><a href=#__codelineno-4-70> 70</a></span>
<span class=normal><a href=#__codelineno-4-71> 71</a></span>
<span class=normal><a href=#__codelineno-4-72> 72</a></span>
<span class=normal><a href=#__codelineno-4-73> 73</a></span>
<span class=normal><a href=#__codelineno-4-74> 74</a></span>
<span class=normal><a href=#__codelineno-4-75> 75</a></span>
<span class=normal><a href=#__codelineno-4-76> 76</a></span>
<span class=normal><a href=#__codelineno-4-77> 77</a></span>
<span class=normal><a href=#__codelineno-4-78> 78</a></span>
<span class=normal><a href=#__codelineno-4-79> 79</a></span>
<span class=normal><a href=#__codelineno-4-80> 80</a></span>
<span class=normal><a href=#__codelineno-4-81> 81</a></span>
<span class=normal><a href=#__codelineno-4-82> 82</a></span>
<span class=normal><a href=#__codelineno-4-83> 83</a></span>
<span class=normal><a href=#__codelineno-4-84> 84</a></span>
<span class=normal><a href=#__codelineno-4-85> 85</a></span>
<span class=normal><a href=#__codelineno-4-86> 86</a></span>
<span class=normal><a href=#__codelineno-4-87> 87</a></span>
<span class=normal><a href=#__codelineno-4-88> 88</a></span>
<span class=normal><a href=#__codelineno-4-89> 89</a></span>
<span class=normal><a href=#__codelineno-4-90> 90</a></span>
<span class=normal><a href=#__codelineno-4-91> 91</a></span>
<span class=normal><a href=#__codelineno-4-92> 92</a></span>
<span class=normal><a href=#__codelineno-4-93> 93</a></span>
<span class=normal><a href=#__codelineno-4-94> 94</a></span>
<span class=normal><a href=#__codelineno-4-95> 95</a></span>
<span class=normal><a href=#__codelineno-4-96> 96</a></span>
<span class=normal><a href=#__codelineno-4-97> 97</a></span>
<span class=normal><a href=#__codelineno-4-98> 98</a></span>
<span class=normal><a href=#__codelineno-4-99> 99</a></span>
<span class=normal><a href=#__codelineno-4-100>100</a></span>
<span class=normal><a href=#__codelineno-4-101>101</a></span>
<span class=normal><a href=#__codelineno-4-102>102</a></span>
<span class=normal><a href=#__codelineno-4-103>103</a></span>
<span class=normal><a href=#__codelineno-4-104>104</a></span>
<span class=normal><a href=#__codelineno-4-105>105</a></span>
<span class=normal><a href=#__codelineno-4-106>106</a></span>
<span class=normal><a href=#__codelineno-4-107>107</a></span>
<span class=normal><a href=#__codelineno-4-108>108</a></span>
<span class=normal><a href=#__codelineno-4-109>109</a></span>
<span class=normal><a href=#__codelineno-4-110>110</a></span>
<span class=normal><a href=#__codelineno-4-111>111</a></span>
<span class=normal><a href=#__codelineno-4-112>112</a></span>
<span class=normal><a href=#__codelineno-4-113>113</a></span>
<span class=normal><a href=#__codelineno-4-114>114</a></span>
<span class=normal><a href=#__codelineno-4-115>115</a></span>
<span class=normal><a href=#__codelineno-4-116>116</a></span>
<span class=normal><a href=#__codelineno-4-117>117</a></span>
<span class=normal><a href=#__codelineno-4-118>118</a></span>
<span class=normal><a href=#__codelineno-4-119>119</a></span>
<span class=normal><a href=#__codelineno-4-120>120</a></span>
<span class=normal><a href=#__codelineno-4-121>121</a></span>
<span class=normal><a href=#__codelineno-4-122>122</a></span>
<span class=normal><a href=#__codelineno-4-123>123</a></span>
<span class=normal><a href=#__codelineno-4-124>124</a></span>
<span class=normal><a href=#__codelineno-4-125>125</a></span>
<span class=normal><a href=#__codelineno-4-126>126</a></span>
<span class=normal><a href=#__codelineno-4-127>127</a></span>
<span class=normal><a href=#__codelineno-4-128>128</a></span>
<span class=normal><a href=#__codelineno-4-129>129</a></span>
<span class=normal><a href=#__codelineno-4-130>130</a></span>
<span class=normal><a href=#__codelineno-4-131>131</a></span>
<span class=normal><a href=#__codelineno-4-132>132</a></span>
<span class=normal><a href=#__codelineno-4-133>133</a></span>
<span class=normal><a href=#__codelineno-4-134>134</a></span>
<span class=normal><a href=#__codelineno-4-135>135</a></span>
<span class=normal><a href=#__codelineno-4-136>136</a></span>
<span class=normal><a href=#__codelineno-4-137>137</a></span>
<span class=normal><a href=#__codelineno-4-138>138</a></span>
<span class=normal><a href=#__codelineno-4-139>139</a></span>
<span class=normal><a href=#__codelineno-4-140>140</a></span>
<span class=normal><a href=#__codelineno-4-141>141</a></span>
<span class=normal><a href=#__codelineno-4-142>142</a></span>
<span class=normal><a href=#__codelineno-4-143>143</a></span>
<span class=normal><a href=#__codelineno-4-144>144</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2></a>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3></a><span class=sd>import brahe as bh</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4></a><span class=sd>import numpy as np</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5></a>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7></a><span class=sd>def dynamics_with_params(t, state, params):</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8></a><span class=sd>    &quot;&quot;&quot;</span><span class=n>Orbital</span> <span class=n>dynamics</span> <span class=k>with</span> <span class=n>atmospheric</span> <span class=n>drag</span><span class=o>.</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9></a>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10></a>    <span class=n>Args</span><span class=p>:</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11></a>        <span class=n>t</span><span class=p>:</span> <span class=n>Time</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12></a>        <span class=n>state</span><span class=p>:</span> <span class=p>[</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>,</span> <span class=n>vx</span><span class=p>,</span> <span class=n>vy</span><span class=p>,</span> <span class=n>vz</span><span class=p>]</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13></a>        <span class=n>params</span><span class=p>:</span> <span class=p>[</span><span class=n>cd_area_m</span><span class=p>]</span> <span class=o>-</span> <span class=n>drag</span> <span class=n>coefficient</span> <span class=o>*</span> <span class=n>area</span> <span class=o>/</span> <span class=n>mass</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15></a><span class=sd>    cd_area_m = params[0]</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16></a>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17></a><span class=sd>    r = state[:3]</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18></a><span class=sd>    v = state[3:]</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19></a><span class=sd>    r_norm = np.linalg.norm(r)</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20></a><span class=sd>    a_grav = -bh.GM_EARTH / (r_norm**3) * r</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21></a>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22></a><span class=sd>    # Atmospheric drag (simplified exponential model)</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23></a><span class=sd>    h = r_norm - bh.R_EARTH</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24></a><span class=sd>    rho0 = 1.225  # kg/m^3 at sea level</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25></a><span class=sd>    H = 8500.0  # Scale height in meters</span>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26></a><span class=sd>    rho = rho0 * np.exp(-h / H)</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27></a>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28></a><span class=sd>    v_norm = np.linalg.norm(v)</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29></a><span class=sd>    a_drag = -0.5 * rho * cd_area_m * v_norm * v</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30></a>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31></a><span class=sd>    return np.concatenate([v, a_grav + a_drag])</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32></a>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33></a>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34></a><span class=sd># Consider parameters</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35></a><span class=sd>cd_area_m = 2.2 * 10.0 / 500.0  # Cd=2.2, A=10m^2, m=500kg</span>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36></a><span class=sd>params = np.array([cd_area_m])</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37></a><span class=sd>num_params = len(params)</span>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38></a>
</span><span id=__span-4-39><a id=__codelineno-4-39 name=__codelineno-4-39></a><span class=sd># Create sensitivity provider using NumericalSensitivity</span>
</span><span id=__span-4-40><a id=__codelineno-4-40 name=__codelineno-4-40></a><span class=sd>sensitivity_provider = bh.NumericalSensitivity.central(dynamics_with_params)</span>
</span><span id=__span-4-41><a id=__codelineno-4-41 name=__codelineno-4-41></a>
</span><span id=__span-4-42><a id=__codelineno-4-42 name=__codelineno-4-42></a><span class=sd># Create Jacobian provider using NumericalJacobian</span>
</span><span id=__span-4-43><a id=__codelineno-4-43 name=__codelineno-4-43></a><span class=sd>jacobian_provider = bh.NumericalJacobian.central(</span>
</span><span id=__span-4-44><a id=__codelineno-4-44 name=__codelineno-4-44></a><span class=sd>    lambda t, s: dynamics_with_params(t, s, params)</span>
</span><span id=__span-4-45><a id=__codelineno-4-45 name=__codelineno-4-45></a><span class=sd>)</span>
</span><span id=__span-4-46><a id=__codelineno-4-46 name=__codelineno-4-46></a>
</span><span id=__span-4-47><a id=__codelineno-4-47 name=__codelineno-4-47></a>
</span><span id=__span-4-48><a id=__codelineno-4-48 name=__codelineno-4-48></a><span class=sd>def augmented_dynamics(t, aug_state):</span>
</span><span id=__span-4-49><a id=__codelineno-4-49 name=__codelineno-4-49></a><span class=sd>    &quot;&quot;&quot;</span><span class=n>Augmented</span> <span class=n>dynamics</span> <span class=k>for</span> <span class=n>state</span> <span class=o>+</span> <span class=n>sensitivity</span> <span class=n>matrix</span> <span class=n>propagation</span><span class=o>.</span>
</span><span id=__span-4-50><a id=__codelineno-4-50 name=__codelineno-4-50></a>
</span><span id=__span-4-51><a id=__codelineno-4-51 name=__codelineno-4-51></a>    <span class=n>Propagates</span><span class=p>:</span>
</span><span id=__span-4-52><a id=__codelineno-4-52 name=__codelineno-4-52></a>        <span class=n>dx</span><span class=o>/</span><span class=n>dt</span> <span class=o>=</span> <span class=n>f</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span><span id=__span-4-53><a id=__codelineno-4-53 name=__codelineno-4-53></a>        <span class=n>dΦ</span><span class=o>/</span><span class=n>dt</span> <span class=o>=</span> <span class=p>(</span><span class=err>∂</span><span class=n>f</span><span class=o>/</span><span class=err>∂</span><span class=n>x</span><span class=p>)</span> <span class=o>*</span> <span class=n>Φ</span> <span class=o>+</span> <span class=p>(</span><span class=err>∂</span><span class=n>f</span><span class=o>/</span><span class=err>∂</span><span class=n>p</span><span class=p>)</span>
</span><span id=__span-4-54><a id=__codelineno-4-54 name=__codelineno-4-54></a>
</span><span id=__span-4-55><a id=__codelineno-4-55 name=__codelineno-4-55></a>    <span class=n>Args</span><span class=p>:</span>
</span><span id=__span-4-56><a id=__codelineno-4-56 name=__codelineno-4-56></a>        <span class=n>t</span><span class=p>:</span> <span class=n>Time</span>
</span><span id=__span-4-57><a id=__codelineno-4-57 name=__codelineno-4-57></a>        <span class=n>aug_state</span><span class=p>:</span> <span class=p>[</span><span class=n>state</span> <span class=p>(</span><span class=mi>6</span><span class=p>),</span> <span class=n>vec</span><span class=p>(</span><span class=n>Φ</span><span class=p>)</span> <span class=p>(</span><span class=mi>6</span><span class=o>*</span><span class=n>num_params</span><span class=p>)]</span>
</span><span id=__span-4-58><a id=__codelineno-4-58 name=__codelineno-4-58></a>    <span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-4-59><a id=__codelineno-4-59 name=__codelineno-4-59></a><span class=s2>    state = aug_state[:6]</span>
</span><span id=__span-4-60><a id=__codelineno-4-60 name=__codelineno-4-60></a><span class=s2>    phi = aug_state[6:].reshape(6, num_params)</span>
</span><span id=__span-4-61><a id=__codelineno-4-61 name=__codelineno-4-61></a>
</span><span id=__span-4-62><a id=__codelineno-4-62 name=__codelineno-4-62></a><span class=s2>    # State derivative</span>
</span><span id=__span-4-63><a id=__codelineno-4-63 name=__codelineno-4-63></a><span class=s2>    state_dot = dynamics_with_params(t, state, params)</span>
</span><span id=__span-4-64><a id=__codelineno-4-64 name=__codelineno-4-64></a>
</span><span id=__span-4-65><a id=__codelineno-4-65 name=__codelineno-4-65></a><span class=s2>    # Compute Jacobian ∂f/∂x</span>
</span><span id=__span-4-66><a id=__codelineno-4-66 name=__codelineno-4-66></a><span class=s2>    jacobian = jacobian_provider.compute(t, state)</span>
</span><span id=__span-4-67><a id=__codelineno-4-67 name=__codelineno-4-67></a>
</span><span id=__span-4-68><a id=__codelineno-4-68 name=__codelineno-4-68></a><span class=s2>    # Compute sensitivity ∂f/∂p</span>
</span><span id=__span-4-69><a id=__codelineno-4-69 name=__codelineno-4-69></a><span class=s2>    sensitivity = sensitivity_provider.compute(t, state, params)</span>
</span><span id=__span-4-70><a id=__codelineno-4-70 name=__codelineno-4-70></a>
</span><span id=__span-4-71><a id=__codelineno-4-71 name=__codelineno-4-71></a><span class=s2>    # Sensitivity matrix derivative: dΦ/dt = J*Φ + S</span>
</span><span id=__span-4-72><a id=__codelineno-4-72 name=__codelineno-4-72></a><span class=s2>    phi_dot = jacobian @ phi + sensitivity</span>
</span><span id=__span-4-73><a id=__codelineno-4-73 name=__codelineno-4-73></a>
</span><span id=__span-4-74><a id=__codelineno-4-74 name=__codelineno-4-74></a><span class=s2>    return np.concatenate([state_dot, phi_dot.flatten()])</span>
</span><span id=__span-4-75><a id=__codelineno-4-75 name=__codelineno-4-75></a>
</span><span id=__span-4-76><a id=__codelineno-4-76 name=__codelineno-4-76></a>
</span><span id=__span-4-77><a id=__codelineno-4-77 name=__codelineno-4-77></a><span class=s2># Initial state (200 km LEO for significant drag effects)</span>
</span><span id=__span-4-78><a id=__codelineno-4-78 name=__codelineno-4-78></a><span class=s2>oe = np.array([bh.R_EARTH + 200e3, 0.001, 51.6, 0.0, 0.0, 0.0])</span>
</span><span id=__span-4-79><a id=__codelineno-4-79 name=__codelineno-4-79></a><span class=s2>state = bh.state_osculating_to_cartesian(oe, bh.AngleFormat.DEGREES)</span>
</span><span id=__span-4-80><a id=__codelineno-4-80 name=__codelineno-4-80></a>
</span><span id=__span-4-81><a id=__codelineno-4-81 name=__codelineno-4-81></a><span class=s2># Initial sensitivity matrix (identity would mean we start with unit sensitivity,</span>
</span><span id=__span-4-82><a id=__codelineno-4-82 name=__codelineno-4-82></a><span class=s2># but we start with zero since we&#39;re interested in how sensitivity develops)</span>
</span><span id=__span-4-83><a id=__codelineno-4-83 name=__codelineno-4-83></a><span class=s2>phi0 = np.zeros((6, num_params))</span>
</span><span id=__span-4-84><a id=__codelineno-4-84 name=__codelineno-4-84></a>
</span><span id=__span-4-85><a id=__codelineno-4-85 name=__codelineno-4-85></a><span class=s2># Augmented initial state</span>
</span><span id=__span-4-86><a id=__codelineno-4-86 name=__codelineno-4-86></a><span class=s2>aug_state = np.concatenate([state, phi0.flatten()])</span>
</span><span id=__span-4-87><a id=__codelineno-4-87 name=__codelineno-4-87></a>
</span><span id=__span-4-88><a id=__codelineno-4-88 name=__codelineno-4-88></a><span class=s2># Create integrator for augmented system</span>
</span><span id=__span-4-89><a id=__codelineno-4-89 name=__codelineno-4-89></a><span class=s2># Using fixed step RK4 for simplicity and exact parity with Rust</span>
</span><span id=__span-4-90><a id=__codelineno-4-90 name=__codelineno-4-90></a><span class=s2>aug_dim = 6 + 6 * num_params</span>
</span><span id=__span-4-91><a id=__codelineno-4-91 name=__codelineno-4-91></a><span class=s2>config = bh.IntegratorConfig.fixed_step(1.0)</span>
</span><span id=__span-4-92><a id=__codelineno-4-92 name=__codelineno-4-92></a><span class=s2>integrator = bh.RK4Integrator(aug_dim, augmented_dynamics, config=config)</span>
</span><span id=__span-4-93><a id=__codelineno-4-93 name=__codelineno-4-93></a>
</span><span id=__span-4-94><a id=__codelineno-4-94 name=__codelineno-4-94></a><span class=s2># Propagate for 1 hour</span>
</span><span id=__span-4-95><a id=__codelineno-4-95 name=__codelineno-4-95></a><span class=s2>t = 0.0</span>
</span><span id=__span-4-96><a id=__codelineno-4-96 name=__codelineno-4-96></a><span class=s2>dt = 1.0</span>
</span><span id=__span-4-97><a id=__codelineno-4-97 name=__codelineno-4-97></a><span class=s2>t_final = 3600.0</span>
</span><span id=__span-4-98><a id=__codelineno-4-98 name=__codelineno-4-98></a>
</span><span id=__span-4-99><a id=__codelineno-4-99 name=__codelineno-4-99></a><span class=s2>while t &lt; t_final:</span>
</span><span id=__span-4-100><a id=__codelineno-4-100 name=__codelineno-4-100></a><span class=s2>    aug_state = integrator.step(t, aug_state, dt)</span>
</span><span id=__span-4-101><a id=__codelineno-4-101 name=__codelineno-4-101></a><span class=s2>    t += dt</span>
</span><span id=__span-4-102><a id=__codelineno-4-102 name=__codelineno-4-102></a>
</span><span id=__span-4-103><a id=__codelineno-4-103 name=__codelineno-4-103></a><span class=s2># Extract final state and sensitivity matrix</span>
</span><span id=__span-4-104><a id=__codelineno-4-104 name=__codelineno-4-104></a><span class=s2>final_state = aug_state[:6]</span>
</span><span id=__span-4-105><a id=__codelineno-4-105 name=__codelineno-4-105></a><span class=s2>final_phi = aug_state[6:].reshape(6, num_params)</span>
</span><span id=__span-4-106><a id=__codelineno-4-106 name=__codelineno-4-106></a>
</span><span id=__span-4-107><a id=__codelineno-4-107 name=__codelineno-4-107></a><span class=s2>print(f&quot;Final position after {t_final / 60:.0f} minutes:&quot;)</span>
</span><span id=__span-4-108><a id=__codelineno-4-108 name=__codelineno-4-108></a><span class=s2>print(f&quot;  x: {final_state[0] / 1000:.3f} km&quot;)</span>
</span><span id=__span-4-109><a id=__codelineno-4-109 name=__codelineno-4-109></a><span class=s2>print(f&quot;  y: {final_state[1] / 1000:.3f} km&quot;)</span>
</span><span id=__span-4-110><a id=__codelineno-4-110 name=__codelineno-4-110></a><span class=s2>print(f&quot;  z: {final_state[2] / 1000:.3f} km&quot;)</span>
</span><span id=__span-4-111><a id=__codelineno-4-111 name=__codelineno-4-111></a>
</span><span id=__span-4-112><a id=__codelineno-4-112 name=__codelineno-4-112></a><span class=s2>print(&quot;</span><span class=se>\n</span><span class=s2>Sensitivity matrix Φ = ∂x/∂p (position per unit Cd*A/m):&quot;)</span>
</span><span id=__span-4-113><a id=__codelineno-4-113 name=__codelineno-4-113></a><span class=s2>print(f&quot;  dx/dp: </span><span class=si>{final_phi[0, 0]:.3f}</span><span class=s2> m/(m²/kg)&quot;)</span>
</span><span id=__span-4-114><a id=__codelineno-4-114 name=__codelineno-4-114></a><span class=s2>print(f&quot;  dy/dp: </span><span class=si>{final_phi[1, 0]:.3f}</span><span class=s2> m/(m²/kg)&quot;)</span>
</span><span id=__span-4-115><a id=__codelineno-4-115 name=__codelineno-4-115></a><span class=s2>print(f&quot;  dz/dp: </span><span class=si>{final_phi[2, 0]:.3f}</span><span class=s2> m/(m²/kg)&quot;)</span>
</span><span id=__span-4-116><a id=__codelineno-4-116 name=__codelineno-4-116></a>
</span><span id=__span-4-117><a id=__codelineno-4-117 name=__codelineno-4-117></a><span class=s2>print(&quot;</span><span class=se>\n</span><span class=s2>Sensitivity matrix Φ = ∂x/∂p (velocity per unit Cd*A/m):&quot;)</span>
</span><span id=__span-4-118><a id=__codelineno-4-118 name=__codelineno-4-118></a><span class=s2>print(f&quot;  dvx/dp: </span><span class=si>{final_phi[3, 0]:.6f}</span><span class=s2> m/s/(m²/kg)&quot;)</span>
</span><span id=__span-4-119><a id=__codelineno-4-119 name=__codelineno-4-119></a><span class=s2>print(f&quot;  dvy/dp: </span><span class=si>{final_phi[4, 0]:.6f}</span><span class=s2> m/s/(m²/kg)&quot;)</span>
</span><span id=__span-4-120><a id=__codelineno-4-120 name=__codelineno-4-120></a><span class=s2>print(f&quot;  dvz/dp: </span><span class=si>{final_phi[5, 0]:.6f}</span><span class=s2> m/s/(m²/kg)&quot;)</span>
</span><span id=__span-4-121><a id=__codelineno-4-121 name=__codelineno-4-121></a>
</span><span id=__span-4-122><a id=__codelineno-4-122 name=__codelineno-4-122></a><span class=s2># Interpret: If we have 10</span><span class=si>% u</span><span class=s2>ncertainty in Cd*A/m (0.1 * 0.044 = 0.0044),</span>
</span><span id=__span-4-123><a id=__codelineno-4-123 name=__codelineno-4-123></a><span class=s2># the position uncertainty after 1 hour would be:</span>
</span><span id=__span-4-124><a id=__codelineno-4-124 name=__codelineno-4-124></a><span class=s2>delta_p = 0.1 * cd_area_m</span>
</span><span id=__span-4-125><a id=__codelineno-4-125 name=__codelineno-4-125></a><span class=s2>pos_uncertainty = np.linalg.norm(final_phi[:3, 0]) * delta_p</span>
</span><span id=__span-4-126><a id=__codelineno-4-126 name=__codelineno-4-126></a><span class=s2>print(f&quot;</span><span class=se>\n</span><span class=s2>Position uncertainty for 10% parameter uncertainty: </span><span class=si>{pos_uncertainty:.1f}</span><span class=s2> m&quot;)</span>
</span><span id=__span-4-127><a id=__codelineno-4-127 name=__codelineno-4-127></a>
</span><span id=__span-4-128><a id=__codelineno-4-128 name=__codelineno-4-128></a><span class=s2># Expected output:</span>
</span><span id=__span-4-129><a id=__codelineno-4-129 name=__codelineno-4-129></a><span class=s2># Final position after 60 minutes:</span>
</span><span id=__span-4-130><a id=__codelineno-4-130 name=__codelineno-4-130></a><span class=s2>#   x: -2884.245 km</span>
</span><span id=__span-4-131><a id=__codelineno-4-131 name=__codelineno-4-131></a><span class=s2>#   y: -3673.659 km</span>
</span><span id=__span-4-132><a id=__codelineno-4-132 name=__codelineno-4-132></a><span class=s2>#   z: -4635.004 km</span>
</span><span id=__span-4-133><a id=__codelineno-4-133 name=__codelineno-4-133></a>
</span><span id=__span-4-134><a id=__codelineno-4-134 name=__codelineno-4-134></a><span class=s2># Sensitivity matrix Φ = ∂x/∂p (position per unit Cd*A/m):</span>
</span><span id=__span-4-135><a id=__codelineno-4-135 name=__codelineno-4-135></a><span class=s2>#   dx/dp: 59942.894 m/(m²/kg)</span>
</span><span id=__span-4-136><a id=__codelineno-4-136 name=__codelineno-4-136></a><span class=s2>#   dy/dp: -3796.878 m/(m²/kg)</span>
</span><span id=__span-4-137><a id=__codelineno-4-137 name=__codelineno-4-137></a><span class=s2>#   dz/dp: -4790.467 m/(m²/kg)</span>
</span><span id=__span-4-138><a id=__codelineno-4-138 name=__codelineno-4-138></a>
</span><span id=__span-4-139><a id=__codelineno-4-139 name=__codelineno-4-139></a><span class=s2># Sensitivity matrix Φ = ∂x/∂p (velocity per unit Cd*A/m):</span>
</span><span id=__span-4-140><a id=__codelineno-4-140 name=__codelineno-4-140></a><span class=s2>#   dvx/dp: 44.091413 m/s/(m²/kg)</span>
</span><span id=__span-4-141><a id=__codelineno-4-141 name=__codelineno-4-141></a><span class=s2>#   dvy/dp: 33.444231 m/s/(m²/kg)</span>
</span><span id=__span-4-142><a id=__codelineno-4-142 name=__codelineno-4-142></a><span class=s2>#   dvz/dp: 42.196119 m/s/(m²/kg)</span>
</span><span id=__span-4-143><a id=__codelineno-4-143 name=__codelineno-4-143></a>
</span><span id=__span-4-144><a id=__codelineno-4-144 name=__codelineno-4-144></a><span class=s2># Position uncertainty for 10% parameter uncertainty: 265.1 m</span>
</span></code></pre></div></td></tr></table></div> </div> <div class=tabbed-block> <div class="language-rust highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1>  1</a></span>
<span class=normal><a href=#__codelineno-5-2>  2</a></span>
<span class=normal><a href=#__codelineno-5-3>  3</a></span>
<span class=normal><a href=#__codelineno-5-4>  4</a></span>
<span class=normal><a href=#__codelineno-5-5>  5</a></span>
<span class=normal><a href=#__codelineno-5-6>  6</a></span>
<span class=normal><a href=#__codelineno-5-7>  7</a></span>
<span class=normal><a href=#__codelineno-5-8>  8</a></span>
<span class=normal><a href=#__codelineno-5-9>  9</a></span>
<span class=normal><a href=#__codelineno-5-10> 10</a></span>
<span class=normal><a href=#__codelineno-5-11> 11</a></span>
<span class=normal><a href=#__codelineno-5-12> 12</a></span>
<span class=normal><a href=#__codelineno-5-13> 13</a></span>
<span class=normal><a href=#__codelineno-5-14> 14</a></span>
<span class=normal><a href=#__codelineno-5-15> 15</a></span>
<span class=normal><a href=#__codelineno-5-16> 16</a></span>
<span class=normal><a href=#__codelineno-5-17> 17</a></span>
<span class=normal><a href=#__codelineno-5-18> 18</a></span>
<span class=normal><a href=#__codelineno-5-19> 19</a></span>
<span class=normal><a href=#__codelineno-5-20> 20</a></span>
<span class=normal><a href=#__codelineno-5-21> 21</a></span>
<span class=normal><a href=#__codelineno-5-22> 22</a></span>
<span class=normal><a href=#__codelineno-5-23> 23</a></span>
<span class=normal><a href=#__codelineno-5-24> 24</a></span>
<span class=normal><a href=#__codelineno-5-25> 25</a></span>
<span class=normal><a href=#__codelineno-5-26> 26</a></span>
<span class=normal><a href=#__codelineno-5-27> 27</a></span>
<span class=normal><a href=#__codelineno-5-28> 28</a></span>
<span class=normal><a href=#__codelineno-5-29> 29</a></span>
<span class=normal><a href=#__codelineno-5-30> 30</a></span>
<span class=normal><a href=#__codelineno-5-31> 31</a></span>
<span class=normal><a href=#__codelineno-5-32> 32</a></span>
<span class=normal><a href=#__codelineno-5-33> 33</a></span>
<span class=normal><a href=#__codelineno-5-34> 34</a></span>
<span class=normal><a href=#__codelineno-5-35> 35</a></span>
<span class=normal><a href=#__codelineno-5-36> 36</a></span>
<span class=normal><a href=#__codelineno-5-37> 37</a></span>
<span class=normal><a href=#__codelineno-5-38> 38</a></span>
<span class=normal><a href=#__codelineno-5-39> 39</a></span>
<span class=normal><a href=#__codelineno-5-40> 40</a></span>
<span class=normal><a href=#__codelineno-5-41> 41</a></span>
<span class=normal><a href=#__codelineno-5-42> 42</a></span>
<span class=normal><a href=#__codelineno-5-43> 43</a></span>
<span class=normal><a href=#__codelineno-5-44> 44</a></span>
<span class=normal><a href=#__codelineno-5-45> 45</a></span>
<span class=normal><a href=#__codelineno-5-46> 46</a></span>
<span class=normal><a href=#__codelineno-5-47> 47</a></span>
<span class=normal><a href=#__codelineno-5-48> 48</a></span>
<span class=normal><a href=#__codelineno-5-49> 49</a></span>
<span class=normal><a href=#__codelineno-5-50> 50</a></span>
<span class=normal><a href=#__codelineno-5-51> 51</a></span>
<span class=normal><a href=#__codelineno-5-52> 52</a></span>
<span class=normal><a href=#__codelineno-5-53> 53</a></span>
<span class=normal><a href=#__codelineno-5-54> 54</a></span>
<span class=normal><a href=#__codelineno-5-55> 55</a></span>
<span class=normal><a href=#__codelineno-5-56> 56</a></span>
<span class=normal><a href=#__codelineno-5-57> 57</a></span>
<span class=normal><a href=#__codelineno-5-58> 58</a></span>
<span class=normal><a href=#__codelineno-5-59> 59</a></span>
<span class=normal><a href=#__codelineno-5-60> 60</a></span>
<span class=normal><a href=#__codelineno-5-61> 61</a></span>
<span class=normal><a href=#__codelineno-5-62> 62</a></span>
<span class=normal><a href=#__codelineno-5-63> 63</a></span>
<span class=normal><a href=#__codelineno-5-64> 64</a></span>
<span class=normal><a href=#__codelineno-5-65> 65</a></span>
<span class=normal><a href=#__codelineno-5-66> 66</a></span>
<span class=normal><a href=#__codelineno-5-67> 67</a></span>
<span class=normal><a href=#__codelineno-5-68> 68</a></span>
<span class=normal><a href=#__codelineno-5-69> 69</a></span>
<span class=normal><a href=#__codelineno-5-70> 70</a></span>
<span class=normal><a href=#__codelineno-5-71> 71</a></span>
<span class=normal><a href=#__codelineno-5-72> 72</a></span>
<span class=normal><a href=#__codelineno-5-73> 73</a></span>
<span class=normal><a href=#__codelineno-5-74> 74</a></span>
<span class=normal><a href=#__codelineno-5-75> 75</a></span>
<span class=normal><a href=#__codelineno-5-76> 76</a></span>
<span class=normal><a href=#__codelineno-5-77> 77</a></span>
<span class=normal><a href=#__codelineno-5-78> 78</a></span>
<span class=normal><a href=#__codelineno-5-79> 79</a></span>
<span class=normal><a href=#__codelineno-5-80> 80</a></span>
<span class=normal><a href=#__codelineno-5-81> 81</a></span>
<span class=normal><a href=#__codelineno-5-82> 82</a></span>
<span class=normal><a href=#__codelineno-5-83> 83</a></span>
<span class=normal><a href=#__codelineno-5-84> 84</a></span>
<span class=normal><a href=#__codelineno-5-85> 85</a></span>
<span class=normal><a href=#__codelineno-5-86> 86</a></span>
<span class=normal><a href=#__codelineno-5-87> 87</a></span>
<span class=normal><a href=#__codelineno-5-88> 88</a></span>
<span class=normal><a href=#__codelineno-5-89> 89</a></span>
<span class=normal><a href=#__codelineno-5-90> 90</a></span>
<span class=normal><a href=#__codelineno-5-91> 91</a></span>
<span class=normal><a href=#__codelineno-5-92> 92</a></span>
<span class=normal><a href=#__codelineno-5-93> 93</a></span>
<span class=normal><a href=#__codelineno-5-94> 94</a></span>
<span class=normal><a href=#__codelineno-5-95> 95</a></span>
<span class=normal><a href=#__codelineno-5-96> 96</a></span>
<span class=normal><a href=#__codelineno-5-97> 97</a></span>
<span class=normal><a href=#__codelineno-5-98> 98</a></span>
<span class=normal><a href=#__codelineno-5-99> 99</a></span>
<span class=normal><a href=#__codelineno-5-100>100</a></span>
<span class=normal><a href=#__codelineno-5-101>101</a></span>
<span class=normal><a href=#__codelineno-5-102>102</a></span>
<span class=normal><a href=#__codelineno-5-103>103</a></span>
<span class=normal><a href=#__codelineno-5-104>104</a></span>
<span class=normal><a href=#__codelineno-5-105>105</a></span>
<span class=normal><a href=#__codelineno-5-106>106</a></span>
<span class=normal><a href=#__codelineno-5-107>107</a></span>
<span class=normal><a href=#__codelineno-5-108>108</a></span>
<span class=normal><a href=#__codelineno-5-109>109</a></span>
<span class=normal><a href=#__codelineno-5-110>110</a></span>
<span class=normal><a href=#__codelineno-5-111>111</a></span>
<span class=normal><a href=#__codelineno-5-112>112</a></span>
<span class=normal><a href=#__codelineno-5-113>113</a></span>
<span class=normal><a href=#__codelineno-5-114>114</a></span>
<span class=normal><a href=#__codelineno-5-115>115</a></span>
<span class=normal><a href=#__codelineno-5-116>116</a></span>
<span class=normal><a href=#__codelineno-5-117>117</a></span>
<span class=normal><a href=#__codelineno-5-118>118</a></span>
<span class=normal><a href=#__codelineno-5-119>119</a></span>
<span class=normal><a href=#__codelineno-5-120>120</a></span>
<span class=normal><a href=#__codelineno-5-121>121</a></span>
<span class=normal><a href=#__codelineno-5-122>122</a></span>
<span class=normal><a href=#__codelineno-5-123>123</a></span>
<span class=normal><a href=#__codelineno-5-124>124</a></span>
<span class=normal><a href=#__codelineno-5-125>125</a></span>
<span class=normal><a href=#__codelineno-5-126>126</a></span>
<span class=normal><a href=#__codelineno-5-127>127</a></span>
<span class=normal><a href=#__codelineno-5-128>128</a></span>
<span class=normal><a href=#__codelineno-5-129>129</a></span>
<span class=normal><a href=#__codelineno-5-130>130</a></span>
<span class=normal><a href=#__codelineno-5-131>131</a></span>
<span class=normal><a href=#__codelineno-5-132>132</a></span>
<span class=normal><a href=#__codelineno-5-133>133</a></span>
<span class=normal><a href=#__codelineno-5-134>134</a></span>
<span class=normal><a href=#__codelineno-5-135>135</a></span>
<span class=normal><a href=#__codelineno-5-136>136</a></span>
<span class=normal><a href=#__codelineno-5-137>137</a></span>
<span class=normal><a href=#__codelineno-5-138>138</a></span>
<span class=normal><a href=#__codelineno-5-139>139</a></span>
<span class=normal><a href=#__codelineno-5-140>140</a></span>
<span class=normal><a href=#__codelineno-5-141>141</a></span>
<span class=normal><a href=#__codelineno-5-142>142</a></span>
<span class=normal><a href=#__codelineno-5-143>143</a></span>
<span class=normal><a href=#__codelineno-5-144>144</a></span>
<span class=normal><a href=#__codelineno-5-145>145</a></span>
<span class=normal><a href=#__codelineno-5-146>146</a></span>
<span class=normal><a href=#__codelineno-5-147>147</a></span>
<span class=normal><a href=#__codelineno-5-148>148</a></span>
<span class=normal><a href=#__codelineno-5-149>149</a></span>
<span class=normal><a href=#__codelineno-5-150>150</a></span>
<span class=normal><a href=#__codelineno-5-151>151</a></span>
<span class=normal><a href=#__codelineno-5-152>152</a></span>
<span class=normal><a href=#__codelineno-5-153>153</a></span>
<span class=normal><a href=#__codelineno-5-154>154</a></span>
<span class=normal><a href=#__codelineno-5-155>155</a></span>
<span class=normal><a href=#__codelineno-5-156>156</a></span>
<span class=normal><a href=#__codelineno-5-157>157</a></span>
<span class=normal><a href=#__codelineno-5-158>158</a></span>
<span class=normal><a href=#__codelineno-5-159>159</a></span>
<span class=normal><a href=#__codelineno-5-160>160</a></span>
<span class=normal><a href=#__codelineno-5-161>161</a></span>
<span class=normal><a href=#__codelineno-5-162>162</a></span>
<span class=normal><a href=#__codelineno-5-163>163</a></span>
<span class=normal><a href=#__codelineno-5-164>164</a></span>
<span class=normal><a href=#__codelineno-5-165>165</a></span>
<span class=normal><a href=#__codelineno-5-166>166</a></span>
<span class=normal><a href=#__codelineno-5-167>167</a></span>
<span class=normal><a href=#__codelineno-5-168>168</a></span>
<span class=normal><a href=#__codelineno-5-169>169</a></span>
<span class=normal><a href=#__codelineno-5-170>170</a></span>
<span class=normal><a href=#__codelineno-5-171>171</a></span>
<span class=normal><a href=#__codelineno-5-172>172</a></span>
<span class=normal><a href=#__codelineno-5-173>173</a></span>
<span class=normal><a href=#__codelineno-5-174>174</a></span>
<span class=normal><a href=#__codelineno-5-175>175</a></span>
<span class=normal><a href=#__codelineno-5-176>176</a></span>
<span class=normal><a href=#__codelineno-5-177>177</a></span>
<span class=normal><a href=#__codelineno-5-178>178</a></span>
<span class=normal><a href=#__codelineno-5-179>179</a></span>
<span class=normal><a href=#__codelineno-5-180>180</a></span>
<span class=normal><a href=#__codelineno-5-181>181</a></span>
<span class=normal><a href=#__codelineno-5-182>182</a></span>
<span class=normal><a href=#__codelineno-5-183>183</a></span>
<span class=normal><a href=#__codelineno-5-184>184</a></span>
<span class=normal><a href=#__codelineno-5-185>185</a></span>
<span class=normal><a href=#__codelineno-5-186>186</a></span>
<span class=normal><a href=#__codelineno-5-187>187</a></span>
<span class=normal><a href=#__codelineno-5-188>188</a></span>
<span class=normal><a href=#__codelineno-5-189>189</a></span>
<span class=normal><a href=#__codelineno-5-190>190</a></span>
<span class=normal><a href=#__codelineno-5-191>191</a></span>
<span class=normal><a href=#__codelineno-5-192>192</a></span>
<span class=normal><a href=#__codelineno-5-193>193</a></span>
<span class=normal><a href=#__codelineno-5-194>194</a></span>
<span class=normal><a href=#__codelineno-5-195>195</a></span>
<span class=normal><a href=#__codelineno-5-196>196</a></span>
<span class=normal><a href=#__codelineno-5-197>197</a></span>
<span class=normal><a href=#__codelineno-5-198>198</a></span>
<span class=normal><a href=#__codelineno-5-199>199</a></span>
<span class=normal><a href=#__codelineno-5-200>200</a></span>
<span class=normal><a href=#__codelineno-5-201>201</a></span>
<span class=normal><a href=#__codelineno-5-202>202</a></span>
<span class=normal><a href=#__codelineno-5-203>203</a></span>
<span class=normal><a href=#__codelineno-5-204>204</a></span>
<span class=normal><a href=#__codelineno-5-205>205</a></span>
<span class=normal><a href=#__codelineno-5-206>206</a></span>
<span class=normal><a href=#__codelineno-5-207>207</a></span>
<span class=normal><a href=#__codelineno-5-208>208</a></span>
<span class=normal><a href=#__codelineno-5-209>209</a></span>
<span class=normal><a href=#__codelineno-5-210>210</a></span>
<span class=normal><a href=#__codelineno-5-211>211</a></span>
<span class=normal><a href=#__codelineno-5-212>212</a></span>
<span class=normal><a href=#__codelineno-5-213>213</a></span>
<span class=normal><a href=#__codelineno-5-214>214</a></span>
<span class=normal><a href=#__codelineno-5-215>215</a></span>
<span class=normal><a href=#__codelineno-5-216>216</a></span>
<span class=normal><a href=#__codelineno-5-217>217</a></span>
<span class=normal><a href=#__codelineno-5-218>218</a></span>
<span class=normal><a href=#__codelineno-5-219>219</a></span>
<span class=normal><a href=#__codelineno-5-220>220</a></span>
<span class=normal><a href=#__codelineno-5-221>221</a></span>
<span class=normal><a href=#__codelineno-5-222>222</a></span>
<span class=normal><a href=#__codelineno-5-223>223</a></span>
<span class=normal><a href=#__codelineno-5-224>224</a></span>
<span class=normal><a href=#__codelineno-5-225>225</a></span>
<span class=normal><a href=#__codelineno-5-226>226</a></span>
<span class=normal><a href=#__codelineno-5-227>227</a></span>
<span class=normal><a href=#__codelineno-5-228>228</a></span>
<span class=normal><a href=#__codelineno-5-229>229</a></span>
<span class=normal><a href=#__codelineno-5-230>230</a></span>
<span class=normal><a href=#__codelineno-5-231>231</a></span>
<span class=normal><a href=#__codelineno-5-232>232</a></span>
<span class=normal><a href=#__codelineno-5-233>233</a></span>
<span class=normal><a href=#__codelineno-5-234>234</a></span>
<span class=normal><a href=#__codelineno-5-235>235</a></span>
<span class=normal><a href=#__codelineno-5-236>236</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1></a><span class=sd>//! Sensitivity matrix propagation pattern example.</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2></a><span class=sd>//!</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3></a><span class=sd>//! Demonstrates propagating the sensitivity matrix alongside state to map</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4></a><span class=sd>//! parameter uncertainties to state uncertainties over time.</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5></a><span class=sd>//!</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6></a><span class=sd>//! The sensitivity matrix Φ = ∂x/∂p evolves according to:</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7></a><span class=sd>//!     dΦ/dt = (∂f/∂x) * Φ + (∂f/∂p)</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8></a><span class=sd>//!</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9></a><span class=sd>//! This augmented state approach propagates [state, vec(Φ)] together.</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10></a>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11></a><span class=k>use</span><span class=w> </span><span class=n>brahe</span><span class=p>::</span><span class=n>constants</span><span class=p>::{</span><span class=n>GM_EARTH</span><span class=p>,</span><span class=w> </span><span class=n>R_EARTH</span><span class=p>};</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12></a><span class=k>use</span><span class=w> </span><span class=n>brahe</span><span class=p>::</span><span class=n>integrators</span><span class=p>::</span><span class=o>*</span><span class=p>;</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13></a><span class=k>use</span><span class=w> </span><span class=n>brahe</span><span class=p>::</span><span class=n>math</span><span class=p>::</span><span class=n>jacobian</span><span class=p>::{</span><span class=n>DJacobianProvider</span><span class=p>,</span><span class=w> </span><span class=n>DNumericalJacobian</span><span class=p>};</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14></a><span class=k>use</span><span class=w> </span><span class=n>brahe</span><span class=p>::</span><span class=n>math</span><span class=p>::</span><span class=n>sensitivity</span><span class=p>::{</span><span class=n>DNumericalSensitivity</span><span class=p>,</span><span class=w> </span><span class=n>DSensitivityProvider</span><span class=p>};</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15></a><span class=k>use</span><span class=w> </span><span class=n>brahe</span><span class=p>::{</span><span class=n>state_osculating_to_cartesian</span><span class=p>,</span><span class=w> </span><span class=n>AngleFormat</span><span class=p>};</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16></a><span class=k>use</span><span class=w> </span><span class=n>nalgebra</span><span class=p>::{</span><span class=n>DVector</span><span class=p>,</span><span class=w> </span><span class=n>SVector</span><span class=p>};</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17></a>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18></a><span class=k>fn</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19></a><span class=w>    </span><span class=c1>// Consider parameters</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>cd_area_m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>2.2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>10.0</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mf>500.0</span><span class=p>;</span><span class=w> </span><span class=c1>// Cd=2.2, A=10m^2, m=500kg</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>params</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=n>from_vec</span><span class=p>(</span><span class=fm>vec!</span><span class=p>[</span><span class=n>cd_area_m</span><span class=p>]);</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>num_params</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>params</span><span class=p>.</span><span class=n>len</span><span class=p>();</span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23></a>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24></a><span class=w>    </span><span class=c1>// Dynamics function with parameters</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dynamics_with_params</span><span class=w> </span><span class=o>=</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26></a><span class=w>        </span><span class=o>|</span><span class=n>_t</span><span class=p>:</span><span class=w> </span><span class=kt>f64</span><span class=p>,</span><span class=w> </span><span class=n>state</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>params</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;|</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>cd_area_m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>params</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28></a>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>fixed_rows</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>fixed_rows</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>norm</span><span class=p>();</span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32></a>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33></a><span class=w>            </span><span class=c1>// Gravitational acceleration</span>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>a_grav</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>-</span><span class=n>GM_EARTH</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=p>(</span><span class=n>r_norm</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>r_norm</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>r</span><span class=p>;</span>
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35></a>
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36></a><span class=w>            </span><span class=c1>// Atmospheric drag (simplified exponential model)</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>R_EARTH</span><span class=p>;</span>
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>rho0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1.225</span><span class=p>;</span><span class=w> </span><span class=c1>// kg/m^3</span>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>scale_height</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>8500.0</span><span class=p>;</span><span class=w> </span><span class=c1>// m</span>
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>rho</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rho0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=o>-</span><span class=n>h</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>scale_height</span><span class=p>).</span><span class=n>exp</span><span class=p>();</span>
</span><span id=__span-5-41><a id=__codelineno-5-41 name=__codelineno-5-41></a>
</span><span id=__span-5-42><a id=__codelineno-5-42 name=__codelineno-5-42></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>norm</span><span class=p>();</span>
</span><span id=__span-5-43><a id=__codelineno-5-43 name=__codelineno-5-43></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>a_drag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0.0</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-44><a id=__codelineno-5-44 name=__codelineno-5-44></a><span class=w>                </span><span class=o>-</span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>rho</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>cd_area_m</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v</span>
</span><span id=__span-5-45><a id=__codelineno-5-45 name=__codelineno-5-45></a><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-46><a id=__codelineno-5-46 name=__codelineno-5-46></a><span class=w>                </span><span class=n>nalgebra</span><span class=p>::</span><span class=n>Vector3</span><span class=p>::</span><span class=n>zeros</span><span class=p>()</span>
</span><span id=__span-5-47><a id=__codelineno-5-47 name=__codelineno-5-47></a><span class=w>            </span><span class=p>};</span>
</span><span id=__span-5-48><a id=__codelineno-5-48 name=__codelineno-5-48></a>
</span><span id=__span-5-49><a id=__codelineno-5-49 name=__codelineno-5-49></a><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>state_dot</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>::</span><span class=n>zeros</span><span class=p>(</span><span class=mi>6</span><span class=p>);</span>
</span><span id=__span-5-50><a id=__codelineno-5-50 name=__codelineno-5-50></a><span class=w>            </span><span class=n>state_dot</span>
</span><span id=__span-5-51><a id=__codelineno-5-51 name=__codelineno-5-51></a><span class=w>                </span><span class=p>.</span><span class=n>fixed_rows_mut</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-5-52><a id=__codelineno-5-52 name=__codelineno-5-52></a><span class=w>                </span><span class=p>.</span><span class=n>copy_from</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v</span><span class=p>.</span><span class=n>clone_owned</span><span class=p>());</span>
</span><span id=__span-5-53><a id=__codelineno-5-53 name=__codelineno-5-53></a><span class=w>            </span><span class=n>state_dot</span>
</span><span id=__span-5-54><a id=__codelineno-5-54 name=__codelineno-5-54></a><span class=w>                </span><span class=p>.</span><span class=n>fixed_rows_mut</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span><span id=__span-5-55><a id=__codelineno-5-55 name=__codelineno-5-55></a><span class=w>                </span><span class=p>.</span><span class=n>copy_from</span><span class=p>(</span><span class=o>&amp;</span><span class=p>(</span><span class=n>a_grav</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>a_drag</span><span class=p>));</span>
</span><span id=__span-5-56><a id=__codelineno-5-56 name=__codelineno-5-56></a><span class=w>            </span><span class=n>state_dot</span>
</span><span id=__span-5-57><a id=__codelineno-5-57 name=__codelineno-5-57></a><span class=w>        </span><span class=p>};</span>
</span><span id=__span-5-58><a id=__codelineno-5-58 name=__codelineno-5-58></a>
</span><span id=__span-5-59><a id=__codelineno-5-59 name=__codelineno-5-59></a><span class=w>    </span><span class=c1>// Create sensitivity provider</span>
</span><span id=__span-5-60><a id=__codelineno-5-60 name=__codelineno-5-60></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>sensitivity_provider</span><span class=w> </span><span class=o>=</span>
</span><span id=__span-5-61><a id=__codelineno-5-61 name=__codelineno-5-61></a><span class=w>        </span><span class=n>DNumericalSensitivity</span><span class=p>::</span><span class=n>central</span><span class=p>(</span><span class=nb>Box</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>dynamics_with_params</span><span class=p>.</span><span class=n>clone</span><span class=p>()));</span>
</span><span id=__span-5-62><a id=__codelineno-5-62 name=__codelineno-5-62></a>
</span><span id=__span-5-63><a id=__codelineno-5-63 name=__codelineno-5-63></a><span class=w>    </span><span class=c1>// Create Jacobian provider (dynamics without explicit params for Jacobian)</span>
</span><span id=__span-5-64><a id=__codelineno-5-64 name=__codelineno-5-64></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>params_clone</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>params</span><span class=p>.</span><span class=n>clone</span><span class=p>();</span>
</span><span id=__span-5-65><a id=__codelineno-5-65 name=__codelineno-5-65></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dynamics_for_jacobian</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>move</span><span class=w> </span><span class=o>|</span><span class=n>_t</span><span class=p>:</span><span class=w> </span><span class=kt>f64</span><span class=p>,</span><span class=w> </span><span class=n>state</span><span class=p>:</span><span class=w> </span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;|</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-66><a id=__codelineno-5-66 name=__codelineno-5-66></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>cd_area_m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>params_clone</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span><span id=__span-5-67><a id=__codelineno-5-67 name=__codelineno-5-67></a>
</span><span id=__span-5-68><a id=__codelineno-5-68 name=__codelineno-5-68></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>fixed_rows</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-5-69><a id=__codelineno-5-69 name=__codelineno-5-69></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>fixed_rows</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span>
</span><span id=__span-5-70><a id=__codelineno-5-70 name=__codelineno-5-70></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r</span><span class=p>.</span><span class=n>norm</span><span class=p>();</span>
</span><span id=__span-5-71><a id=__codelineno-5-71 name=__codelineno-5-71></a>
</span><span id=__span-5-72><a id=__codelineno-5-72 name=__codelineno-5-72></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>a_grav</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>-</span><span class=n>GM_EARTH</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=p>(</span><span class=n>r_norm</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>r_norm</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>r</span><span class=p>;</span>
</span><span id=__span-5-73><a id=__codelineno-5-73 name=__codelineno-5-73></a>
</span><span id=__span-5-74><a id=__codelineno-5-74 name=__codelineno-5-74></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>r_norm</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>R_EARTH</span><span class=p>;</span>
</span><span id=__span-5-75><a id=__codelineno-5-75 name=__codelineno-5-75></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>rho0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1.225</span><span class=p>;</span>
</span><span id=__span-5-76><a id=__codelineno-5-76 name=__codelineno-5-76></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>scale_height</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>8500.0</span><span class=p>;</span>
</span><span id=__span-5-77><a id=__codelineno-5-77 name=__codelineno-5-77></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>rho</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rho0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=o>-</span><span class=n>h</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>scale_height</span><span class=p>).</span><span class=n>exp</span><span class=p>();</span>
</span><span id=__span-5-78><a id=__codelineno-5-78 name=__codelineno-5-78></a>
</span><span id=__span-5-79><a id=__codelineno-5-79 name=__codelineno-5-79></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>norm</span><span class=p>();</span>
</span><span id=__span-5-80><a id=__codelineno-5-80 name=__codelineno-5-80></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>a_drag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>0.0</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-81><a id=__codelineno-5-81 name=__codelineno-5-81></a><span class=w>            </span><span class=o>-</span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>rho</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>cd_area_m</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v_norm</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v</span>
</span><span id=__span-5-82><a id=__codelineno-5-82 name=__codelineno-5-82></a><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-83><a id=__codelineno-5-83 name=__codelineno-5-83></a><span class=w>            </span><span class=n>nalgebra</span><span class=p>::</span><span class=n>Vector3</span><span class=p>::</span><span class=n>zeros</span><span class=p>()</span>
</span><span id=__span-5-84><a id=__codelineno-5-84 name=__codelineno-5-84></a><span class=w>        </span><span class=p>};</span>
</span><span id=__span-5-85><a id=__codelineno-5-85 name=__codelineno-5-85></a>
</span><span id=__span-5-86><a id=__codelineno-5-86 name=__codelineno-5-86></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>state_dot</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>::</span><span class=n>zeros</span><span class=p>(</span><span class=mi>6</span><span class=p>);</span>
</span><span id=__span-5-87><a id=__codelineno-5-87 name=__codelineno-5-87></a><span class=w>        </span><span class=n>state_dot</span>
</span><span id=__span-5-88><a id=__codelineno-5-88 name=__codelineno-5-88></a><span class=w>            </span><span class=p>.</span><span class=n>fixed_rows_mut</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-5-89><a id=__codelineno-5-89 name=__codelineno-5-89></a><span class=w>            </span><span class=p>.</span><span class=n>copy_from</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v</span><span class=p>.</span><span class=n>clone_owned</span><span class=p>());</span>
</span><span id=__span-5-90><a id=__codelineno-5-90 name=__codelineno-5-90></a><span class=w>        </span><span class=n>state_dot</span>
</span><span id=__span-5-91><a id=__codelineno-5-91 name=__codelineno-5-91></a><span class=w>            </span><span class=p>.</span><span class=n>fixed_rows_mut</span><span class=p>::</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span><span id=__span-5-92><a id=__codelineno-5-92 name=__codelineno-5-92></a><span class=w>            </span><span class=p>.</span><span class=n>copy_from</span><span class=p>(</span><span class=o>&amp;</span><span class=p>(</span><span class=n>a_grav</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>a_drag</span><span class=p>));</span>
</span><span id=__span-5-93><a id=__codelineno-5-93 name=__codelineno-5-93></a><span class=w>        </span><span class=n>state_dot</span>
</span><span id=__span-5-94><a id=__codelineno-5-94 name=__codelineno-5-94></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-5-95><a id=__codelineno-5-95 name=__codelineno-5-95></a>
</span><span id=__span-5-96><a id=__codelineno-5-96 name=__codelineno-5-96></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>jacobian_provider</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DNumericalJacobian</span><span class=p>::</span><span class=n>central</span><span class=p>(</span><span class=nb>Box</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>dynamics_for_jacobian</span><span class=p>));</span>
</span><span id=__span-5-97><a id=__codelineno-5-97 name=__codelineno-5-97></a>
</span><span id=__span-5-98><a id=__codelineno-5-98 name=__codelineno-5-98></a><span class=w>    </span><span class=c1>// Augmented dynamics for state + sensitivity matrix propagation</span>
</span><span id=__span-5-99><a id=__codelineno-5-99 name=__codelineno-5-99></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>params_for_aug</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>params</span><span class=p>.</span><span class=n>clone</span><span class=p>();</span>
</span><span id=__span-5-100><a id=__codelineno-5-100 name=__codelineno-5-100></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>augmented_dynamics</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>move</span><span class=w> </span><span class=o>|</span><span class=n>t</span><span class=p>:</span><span class=w> </span><span class=kt>f64</span><span class=p>,</span>
</span><span id=__span-5-101><a id=__codelineno-5-101 name=__codelineno-5-101></a><span class=w>                                   </span><span class=n>aug_state</span><span class=p>:</span><span class=w> </span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>,</span>
</span><span id=__span-5-102><a id=__codelineno-5-102 name=__codelineno-5-102></a><span class=w>                                   </span><span class=n>_params</span><span class=p>:</span><span class=w> </span><span class=nb>Option</span><span class=o>&lt;&amp;</span><span class=n>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;&gt;|</span>
</span><span id=__span-5-103><a id=__codelineno-5-103 name=__codelineno-5-103></a><span class=w>          </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>DVector</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-104><a id=__codelineno-5-104 name=__codelineno-5-104></a><span class=w>        </span><span class=c1>// Extract state and sensitivity matrix</span>
</span><span id=__span-5-105><a id=__codelineno-5-105 name=__codelineno-5-105></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>aug_state</span><span class=p>.</span><span class=n>rows</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>).</span><span class=n>into_owned</span><span class=p>();</span>
</span><span id=__span-5-106><a id=__codelineno-5-106 name=__codelineno-5-106></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>phi_flat</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>aug_state</span><span class=p>.</span><span class=n>rows</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>num_params</span><span class=p>).</span><span class=n>into_owned</span><span class=p>();</span>
</span><span id=__span-5-107><a id=__codelineno-5-107 name=__codelineno-5-107></a>
</span><span id=__span-5-108><a id=__codelineno-5-108 name=__codelineno-5-108></a><span class=w>        </span><span class=c1>// Reshape phi from flat vector to matrix (column-major)</span>
</span><span id=__span-5-109><a id=__codelineno-5-109 name=__codelineno-5-109></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>phi</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nalgebra</span><span class=p>::</span><span class=n>DMatrix</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>::</span><span class=n>zeros</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=n>num_params</span><span class=p>);</span>
</span><span id=__span-5-110><a id=__codelineno-5-110 name=__codelineno-5-110></a><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=n>num_params</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-111><a id=__codelineno-5-111 name=__codelineno-5-111></a><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=mi>6</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-112><a id=__codelineno-5-112 name=__codelineno-5-112></a><span class=w>                </span><span class=n>phi</span><span class=p>[(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>j</span><span class=p>)]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>phi_flat</span><span class=p>[</span><span class=n>j</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>];</span>
</span><span id=__span-5-113><a id=__codelineno-5-113 name=__codelineno-5-113></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-5-114><a id=__codelineno-5-114 name=__codelineno-5-114></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-5-115><a id=__codelineno-5-115 name=__codelineno-5-115></a>
</span><span id=__span-5-116><a id=__codelineno-5-116 name=__codelineno-5-116></a><span class=w>        </span><span class=c1>// State derivative</span>
</span><span id=__span-5-117><a id=__codelineno-5-117 name=__codelineno-5-117></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>state_dot</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dynamics_with_params</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>params_for_aug</span><span class=p>);</span>
</span><span id=__span-5-118><a id=__codelineno-5-118 name=__codelineno-5-118></a>
</span><span id=__span-5-119><a id=__codelineno-5-119 name=__codelineno-5-119></a><span class=w>        </span><span class=c1>// Compute Jacobian ∂f/∂x</span>
</span><span id=__span-5-120><a id=__codelineno-5-120 name=__codelineno-5-120></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>jacobian</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jacobian_provider</span><span class=p>.</span><span class=n>compute</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>clone</span><span class=p>());</span>
</span><span id=__span-5-121><a id=__codelineno-5-121 name=__codelineno-5-121></a>
</span><span id=__span-5-122><a id=__codelineno-5-122 name=__codelineno-5-122></a><span class=w>        </span><span class=c1>// Compute sensitivity ∂f/∂p</span>
</span><span id=__span-5-123><a id=__codelineno-5-123 name=__codelineno-5-123></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>sensitivity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sensitivity_provider</span><span class=p>.</span><span class=n>compute</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>params_for_aug</span><span class=p>);</span>
</span><span id=__span-5-124><a id=__codelineno-5-124 name=__codelineno-5-124></a>
</span><span id=__span-5-125><a id=__codelineno-5-125 name=__codelineno-5-125></a><span class=w>        </span><span class=c1>// Sensitivity matrix derivative: dΦ/dt = J*Φ + S</span>
</span><span id=__span-5-126><a id=__codelineno-5-126 name=__codelineno-5-126></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>phi_dot</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>jacobian</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=o>&amp;</span><span class=n>phi</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=o>&amp;</span><span class=n>sensitivity</span><span class=p>;</span>
</span><span id=__span-5-127><a id=__codelineno-5-127 name=__codelineno-5-127></a>
</span><span id=__span-5-128><a id=__codelineno-5-128 name=__codelineno-5-128></a><span class=w>        </span><span class=c1>// Flatten phi_dot back to vector (column-major)</span>
</span><span id=__span-5-129><a id=__codelineno-5-129 name=__codelineno-5-129></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>phi_dot_flat</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>::</span><span class=n>zeros</span><span class=p>(</span><span class=mi>6</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>num_params</span><span class=p>);</span>
</span><span id=__span-5-130><a id=__codelineno-5-130 name=__codelineno-5-130></a><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=n>num_params</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-131><a id=__codelineno-5-131 name=__codelineno-5-131></a><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=mi>6</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-132><a id=__codelineno-5-132 name=__codelineno-5-132></a><span class=w>                </span><span class=n>phi_dot_flat</span><span class=p>[</span><span class=n>j</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>phi_dot</span><span class=p>[(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>j</span><span class=p>)];</span>
</span><span id=__span-5-133><a id=__codelineno-5-133 name=__codelineno-5-133></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-5-134><a id=__codelineno-5-134 name=__codelineno-5-134></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-5-135><a id=__codelineno-5-135 name=__codelineno-5-135></a>
</span><span id=__span-5-136><a id=__codelineno-5-136 name=__codelineno-5-136></a><span class=w>        </span><span class=c1>// Concatenate state_dot and phi_dot</span>
</span><span id=__span-5-137><a id=__codelineno-5-137 name=__codelineno-5-137></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>aug_dot</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>::</span><span class=n>zeros</span><span class=p>(</span><span class=mi>6</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>num_params</span><span class=p>);</span>
</span><span id=__span-5-138><a id=__codelineno-5-138 name=__codelineno-5-138></a><span class=w>        </span><span class=n>aug_dot</span><span class=p>.</span><span class=n>rows_mut</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>).</span><span class=n>copy_from</span><span class=p>(</span><span class=o>&amp;</span><span class=n>state_dot</span><span class=p>);</span>
</span><span id=__span-5-139><a id=__codelineno-5-139 name=__codelineno-5-139></a><span class=w>        </span><span class=n>aug_dot</span><span class=p>.</span><span class=n>rows_mut</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>num_params</span><span class=p>).</span><span class=n>copy_from</span><span class=p>(</span><span class=o>&amp;</span><span class=n>phi_dot_flat</span><span class=p>);</span>
</span><span id=__span-5-140><a id=__codelineno-5-140 name=__codelineno-5-140></a><span class=w>        </span><span class=n>aug_dot</span>
</span><span id=__span-5-141><a id=__codelineno-5-141 name=__codelineno-5-141></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-5-142><a id=__codelineno-5-142 name=__codelineno-5-142></a>
</span><span id=__span-5-143><a id=__codelineno-5-143 name=__codelineno-5-143></a><span class=w>    </span><span class=c1>// Initial state (200 km LEO for significant drag effects)</span>
</span><span id=__span-5-144><a id=__codelineno-5-144 name=__codelineno-5-144></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>oe</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SVector</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=o>&gt;</span><span class=p>::</span><span class=n>from_row_slice</span><span class=p>(</span><span class=o>&amp;</span><span class=p>[</span><span class=n>R_EARTH</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>200e3</span><span class=p>,</span><span class=w> </span><span class=mf>0.001</span><span class=p>,</span><span class=w> </span><span class=mf>51.6</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>,</span><span class=w> </span><span class=mf>0.0</span><span class=p>]);</span>
</span><span id=__span-5-145><a id=__codelineno-5-145 name=__codelineno-5-145></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>state_vec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state_osculating_to_cartesian</span><span class=p>(</span><span class=n>oe</span><span class=p>,</span><span class=w> </span><span class=n>AngleFormat</span><span class=p>::</span><span class=n>Degrees</span><span class=p>);</span>
</span><span id=__span-5-146><a id=__codelineno-5-146 name=__codelineno-5-146></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=n>from_iterator</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=n>state_vec</span><span class=p>.</span><span class=n>iter</span><span class=p>().</span><span class=n>copied</span><span class=p>());</span>
</span><span id=__span-5-147><a id=__codelineno-5-147 name=__codelineno-5-147></a>
</span><span id=__span-5-148><a id=__codelineno-5-148 name=__codelineno-5-148></a><span class=w>    </span><span class=c1>// Initial sensitivity matrix (zeros - we&#39;re interested in how it develops)</span>
</span><span id=__span-5-149><a id=__codelineno-5-149 name=__codelineno-5-149></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>phi0</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>::</span><span class=n>zeros</span><span class=p>(</span><span class=mi>6</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>num_params</span><span class=p>);</span>
</span><span id=__span-5-150><a id=__codelineno-5-150 name=__codelineno-5-150></a>
</span><span id=__span-5-151><a id=__codelineno-5-151 name=__codelineno-5-151></a><span class=w>    </span><span class=c1>// Augmented initial state</span>
</span><span id=__span-5-152><a id=__codelineno-5-152 name=__codelineno-5-152></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>aug_state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DVector</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>::</span><span class=n>zeros</span><span class=p>(</span><span class=mi>6</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>num_params</span><span class=p>);</span>
</span><span id=__span-5-153><a id=__codelineno-5-153 name=__codelineno-5-153></a><span class=w>    </span><span class=n>aug_state</span><span class=p>.</span><span class=n>rows_mut</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>).</span><span class=n>copy_from</span><span class=p>(</span><span class=o>&amp;</span><span class=n>state</span><span class=p>);</span>
</span><span id=__span-5-154><a id=__codelineno-5-154 name=__codelineno-5-154></a><span class=w>    </span><span class=n>aug_state</span><span class=p>.</span><span class=n>rows_mut</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>num_params</span><span class=p>).</span><span class=n>copy_from</span><span class=p>(</span><span class=o>&amp;</span><span class=n>phi0</span><span class=p>);</span>
</span><span id=__span-5-155><a id=__codelineno-5-155 name=__codelineno-5-155></a>
</span><span id=__span-5-156><a id=__codelineno-5-156 name=__codelineno-5-156></a><span class=w>    </span><span class=c1>// Create integrator for augmented system</span>
</span><span id=__span-5-157><a id=__codelineno-5-157 name=__codelineno-5-157></a><span class=w>    </span><span class=c1>// Using fixed step RK4 for simplicity and exact parity with Python</span>
</span><span id=__span-5-158><a id=__codelineno-5-158 name=__codelineno-5-158></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>aug_dim</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>num_params</span><span class=p>;</span>
</span><span id=__span-5-159><a id=__codelineno-5-159 name=__codelineno-5-159></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>IntegratorConfig</span><span class=p>::</span><span class=n>fixed_step</span><span class=p>(</span><span class=mf>1.0</span><span class=p>);</span>
</span><span id=__span-5-160><a id=__codelineno-5-160 name=__codelineno-5-160></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>integrator</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RK4DIntegrator</span><span class=p>::</span><span class=n>with_config</span><span class=p>(</span>
</span><span id=__span-5-161><a id=__codelineno-5-161 name=__codelineno-5-161></a><span class=w>        </span><span class=n>aug_dim</span><span class=p>,</span>
</span><span id=__span-5-162><a id=__codelineno-5-162 name=__codelineno-5-162></a><span class=w>        </span><span class=nb>Box</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>augmented_dynamics</span><span class=p>),</span>
</span><span id=__span-5-163><a id=__codelineno-5-163 name=__codelineno-5-163></a><span class=w>        </span><span class=nb>None</span><span class=p>,</span>
</span><span id=__span-5-164><a id=__codelineno-5-164 name=__codelineno-5-164></a><span class=w>        </span><span class=nb>None</span><span class=p>,</span>
</span><span id=__span-5-165><a id=__codelineno-5-165 name=__codelineno-5-165></a><span class=w>        </span><span class=nb>None</span><span class=p>,</span>
</span><span id=__span-5-166><a id=__codelineno-5-166 name=__codelineno-5-166></a><span class=w>        </span><span class=n>config</span><span class=p>,</span>
</span><span id=__span-5-167><a id=__codelineno-5-167 name=__codelineno-5-167></a><span class=w>    </span><span class=p>);</span>
</span><span id=__span-5-168><a id=__codelineno-5-168 name=__codelineno-5-168></a>
</span><span id=__span-5-169><a id=__codelineno-5-169 name=__codelineno-5-169></a><span class=w>    </span><span class=c1>// Propagate for 1 hour</span>
</span><span id=__span-5-170><a id=__codelineno-5-170 name=__codelineno-5-170></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>t_final</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>3600.0</span><span class=p>;</span>
</span><span id=__span-5-171><a id=__codelineno-5-171 name=__codelineno-5-171></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.0</span><span class=p>;</span>
</span><span id=__span-5-172><a id=__codelineno-5-172 name=__codelineno-5-172></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1.0</span><span class=p>;</span>
</span><span id=__span-5-173><a id=__codelineno-5-173 name=__codelineno-5-173></a>
</span><span id=__span-5-174><a id=__codelineno-5-174 name=__codelineno-5-174></a><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>t_final</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-175><a id=__codelineno-5-175 name=__codelineno-5-175></a><span class=w>        </span><span class=n>aug_state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>integrator</span><span class=p>.</span><span class=n>step</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=n>aug_state</span><span class=p>,</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>dt</span><span class=p>));</span>
</span><span id=__span-5-176><a id=__codelineno-5-176 name=__codelineno-5-176></a><span class=w>        </span><span class=n>t</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>dt</span><span class=p>;</span>
</span><span id=__span-5-177><a id=__codelineno-5-177 name=__codelineno-5-177></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-178><a id=__codelineno-5-178 name=__codelineno-5-178></a>
</span><span id=__span-5-179><a id=__codelineno-5-179 name=__codelineno-5-179></a><span class=w>    </span><span class=c1>// Extract final state and sensitivity matrix</span>
</span><span id=__span-5-180><a id=__codelineno-5-180 name=__codelineno-5-180></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>final_state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>aug_state</span><span class=p>.</span><span class=n>rows</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>).</span><span class=n>into_owned</span><span class=p>();</span>
</span><span id=__span-5-181><a id=__codelineno-5-181 name=__codelineno-5-181></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>final_phi_flat</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>aug_state</span><span class=p>.</span><span class=n>rows</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>num_params</span><span class=p>).</span><span class=n>into_owned</span><span class=p>();</span>
</span><span id=__span-5-182><a id=__codelineno-5-182 name=__codelineno-5-182></a>
</span><span id=__span-5-183><a id=__codelineno-5-183 name=__codelineno-5-183></a><span class=w>    </span><span class=c1>// Reshape to matrix</span>
</span><span id=__span-5-184><a id=__codelineno-5-184 name=__codelineno-5-184></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>final_phi</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nalgebra</span><span class=p>::</span><span class=n>DMatrix</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>f64</span><span class=o>&gt;</span><span class=p>::</span><span class=n>zeros</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=n>num_params</span><span class=p>);</span>
</span><span id=__span-5-185><a id=__codelineno-5-185 name=__codelineno-5-185></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=n>num_params</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-186><a id=__codelineno-5-186 name=__codelineno-5-186></a><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=mi>6</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-187><a id=__codelineno-5-187 name=__codelineno-5-187></a><span class=w>            </span><span class=n>final_phi</span><span class=p>[(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>j</span><span class=p>)]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>final_phi_flat</span><span class=p>[</span><span class=n>j</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>];</span>
</span><span id=__span-5-188><a id=__codelineno-5-188 name=__codelineno-5-188></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-5-189><a id=__codelineno-5-189 name=__codelineno-5-189></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-190><a id=__codelineno-5-190 name=__codelineno-5-190></a>
</span><span id=__span-5-191><a id=__codelineno-5-191 name=__codelineno-5-191></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;Final position after {} minutes:&quot;</span><span class=p>,</span><span class=w> </span><span class=n>t_final</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mf>60.0</span><span class=p>);</span>
</span><span id=__span-5-192><a id=__codelineno-5-192 name=__codelineno-5-192></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;  x: {:.3} km&quot;</span><span class=p>,</span><span class=w> </span><span class=n>final_state</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mf>1000.0</span><span class=p>);</span>
</span><span id=__span-5-193><a id=__codelineno-5-193 name=__codelineno-5-193></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;  y: {:.3} km&quot;</span><span class=p>,</span><span class=w> </span><span class=n>final_state</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mf>1000.0</span><span class=p>);</span>
</span><span id=__span-5-194><a id=__codelineno-5-194 name=__codelineno-5-194></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;  z: {:.3} km&quot;</span><span class=p>,</span><span class=w> </span><span class=n>final_state</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mf>1000.0</span><span class=p>);</span>
</span><span id=__span-5-195><a id=__codelineno-5-195 name=__codelineno-5-195></a>
</span><span id=__span-5-196><a id=__codelineno-5-196 name=__codelineno-5-196></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;</span><span class=se>\n</span><span class=s>Sensitivity matrix Φ = ∂x/∂p (position per unit Cd*A/m):&quot;</span><span class=p>);</span>
</span><span id=__span-5-197><a id=__codelineno-5-197 name=__codelineno-5-197></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;  dx/dp: {:.3} m/(m²/kg)&quot;</span><span class=p>,</span><span class=w> </span><span class=n>final_phi</span><span class=p>[(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]);</span>
</span><span id=__span-5-198><a id=__codelineno-5-198 name=__codelineno-5-198></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;  dy/dp: {:.3} m/(m²/kg)&quot;</span><span class=p>,</span><span class=w> </span><span class=n>final_phi</span><span class=p>[(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]);</span>
</span><span id=__span-5-199><a id=__codelineno-5-199 name=__codelineno-5-199></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;  dz/dp: {:.3} m/(m²/kg)&quot;</span><span class=p>,</span><span class=w> </span><span class=n>final_phi</span><span class=p>[(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]);</span>
</span><span id=__span-5-200><a id=__codelineno-5-200 name=__codelineno-5-200></a>
</span><span id=__span-5-201><a id=__codelineno-5-201 name=__codelineno-5-201></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;</span><span class=se>\n</span><span class=s>Sensitivity matrix Φ = ∂x/∂p (velocity per unit Cd*A/m):&quot;</span><span class=p>);</span>
</span><span id=__span-5-202><a id=__codelineno-5-202 name=__codelineno-5-202></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;  dvx/dp: {:.6} m/s/(m²/kg)&quot;</span><span class=p>,</span><span class=w> </span><span class=n>final_phi</span><span class=p>[(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]);</span>
</span><span id=__span-5-203><a id=__codelineno-5-203 name=__codelineno-5-203></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;  dvy/dp: {:.6} m/s/(m²/kg)&quot;</span><span class=p>,</span><span class=w> </span><span class=n>final_phi</span><span class=p>[(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]);</span>
</span><span id=__span-5-204><a id=__codelineno-5-204 name=__codelineno-5-204></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&quot;  dvz/dp: {:.6} m/s/(m²/kg)&quot;</span><span class=p>,</span><span class=w> </span><span class=n>final_phi</span><span class=p>[(</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)]);</span>
</span><span id=__span-5-205><a id=__codelineno-5-205 name=__codelineno-5-205></a>
</span><span id=__span-5-206><a id=__codelineno-5-206 name=__codelineno-5-206></a><span class=w>    </span><span class=c1>// Interpret: If we have 10% uncertainty in Cd*A/m,</span>
</span><span id=__span-5-207><a id=__codelineno-5-207 name=__codelineno-5-207></a><span class=w>    </span><span class=c1>// the position uncertainty after 1 hour would be:</span>
</span><span id=__span-5-208><a id=__codelineno-5-208 name=__codelineno-5-208></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>delta_p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.1</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>cd_area_m</span><span class=p>;</span>
</span><span id=__span-5-209><a id=__codelineno-5-209 name=__codelineno-5-209></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>pos_uncertainty</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>final_phi</span><span class=p>[(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)].</span><span class=n>powi</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-5-210><a id=__codelineno-5-210 name=__codelineno-5-210></a><span class=w>        </span><span class=o>+</span><span class=w> </span><span class=n>final_phi</span><span class=p>[(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)].</span><span class=n>powi</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-5-211><a id=__codelineno-5-211 name=__codelineno-5-211></a><span class=w>        </span><span class=o>+</span><span class=w> </span><span class=n>final_phi</span><span class=p>[(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)].</span><span class=n>powi</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span>
</span><span id=__span-5-212><a id=__codelineno-5-212 name=__codelineno-5-212></a><span class=w>    </span><span class=p>.</span><span class=n>sqrt</span><span class=p>()</span>
</span><span id=__span-5-213><a id=__codelineno-5-213 name=__codelineno-5-213></a><span class=w>        </span><span class=o>*</span><span class=w> </span><span class=n>delta_p</span><span class=p>;</span>
</span><span id=__span-5-214><a id=__codelineno-5-214 name=__codelineno-5-214></a><span class=w>    </span><span class=fm>println!</span><span class=p>(</span>
</span><span id=__span-5-215><a id=__codelineno-5-215 name=__codelineno-5-215></a><span class=w>        </span><span class=s>&quot;</span><span class=se>\n</span><span class=s>Position uncertainty for 10% parameter uncertainty: {:.1} m&quot;</span><span class=p>,</span>
</span><span id=__span-5-216><a id=__codelineno-5-216 name=__codelineno-5-216></a><span class=w>        </span><span class=n>pos_uncertainty</span>
</span><span id=__span-5-217><a id=__codelineno-5-217 name=__codelineno-5-217></a><span class=w>    </span><span class=p>);</span>
</span><span id=__span-5-218><a id=__codelineno-5-218 name=__codelineno-5-218></a><span class=p>}</span>
</span><span id=__span-5-219><a id=__codelineno-5-219 name=__codelineno-5-219></a>
</span><span id=__span-5-220><a id=__codelineno-5-220 name=__codelineno-5-220></a><span class=c1>// Example output:</span>
</span><span id=__span-5-221><a id=__codelineno-5-221 name=__codelineno-5-221></a><span class=c1>// Final position after 60 minutes:</span>
</span><span id=__span-5-222><a id=__codelineno-5-222 name=__codelineno-5-222></a><span class=c1>//   x: -2884.245 km</span>
</span><span id=__span-5-223><a id=__codelineno-5-223 name=__codelineno-5-223></a><span class=c1>//   y: -3673.659 km</span>
</span><span id=__span-5-224><a id=__codelineno-5-224 name=__codelineno-5-224></a><span class=c1>//   z: -4635.004 km</span>
</span><span id=__span-5-225><a id=__codelineno-5-225 name=__codelineno-5-225></a>
</span><span id=__span-5-226><a id=__codelineno-5-226 name=__codelineno-5-226></a><span class=c1>// Sensitivity matrix Φ = ∂x/∂p (position per unit Cd*A/m):</span>
</span><span id=__span-5-227><a id=__codelineno-5-227 name=__codelineno-5-227></a><span class=c1>//   dx/dp: 59942.895 m/(m²/kg)</span>
</span><span id=__span-5-228><a id=__codelineno-5-228 name=__codelineno-5-228></a><span class=c1>//   dy/dp: -3796.877 m/(m²/kg)</span>
</span><span id=__span-5-229><a id=__codelineno-5-229 name=__codelineno-5-229></a><span class=c1>//   dz/dp: -4790.467 m/(m²/kg)</span>
</span><span id=__span-5-230><a id=__codelineno-5-230 name=__codelineno-5-230></a>
</span><span id=__span-5-231><a id=__codelineno-5-231 name=__codelineno-5-231></a><span class=c1>// Sensitivity matrix Φ = ∂x/∂p (velocity per unit Cd*A/m):</span>
</span><span id=__span-5-232><a id=__codelineno-5-232 name=__codelineno-5-232></a><span class=c1>//   dvx/dp: 44.091415 m/s/(m²/kg)</span>
</span><span id=__span-5-233><a id=__codelineno-5-233 name=__codelineno-5-233></a><span class=c1>//   dvy/dp: 33.444232 m/s/(m²/kg)</span>
</span><span id=__span-5-234><a id=__codelineno-5-234 name=__codelineno-5-234></a><span class=c1>//   dvz/dp: 42.196119 m/s/(m²/kg)</span>
</span><span id=__span-5-235><a id=__codelineno-5-235 name=__codelineno-5-235></a>
</span><span id=__span-5-236><a id=__codelineno-5-236 name=__codelineno-5-236></a><span class=c1>// Position uncertainty for 10% parameter uncertainty: 265.1 m</span>
</span></code></pre></div></td></tr></table></div> </div> </div> </div> <h2 id=see-also>See Also<a class=headerlink href=#see-also title="Permanent link">&para;</a></h2> <ul> <li><a href=variational_equations.html>Variational Equations</a> - State Transition Matrix theory</li> <li><a href=configuration.html>Configuration Guide</a> - Integrator tuning</li> <li><a href=../mathematics/jacobian.html>Jacobian Computation</a> - Computing the A matrix</li> </ul> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="November 19, 2025 06:16:06 UTC">2025-11-19</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="November 19, 2025 06:16:06 UTC">2025-11-19</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.indexes", "navigation.tracking", "navigation.top3", "toc.follow", "content.tabs.link", "content.code.copy", "search.highlight", "search.suggest"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.f55a23d4.min.js></script> <script src=../../javascripts/katex.d81d3f.min.js></script> <script src=https://unpkg.com/katex@0/dist/katex.min.js></script> <script src=https://unpkg.com/katex@0/dist/contrib/auto-render.min.js></script> <script src=https://cdn.plot.ly/plotly-latest.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../javascripts/tablesort.ae6fa2.min.js></script> </body> </html>